# è½¯ä»¶æœåŠ¡ç®¡ç†å¹³å°å®Œæ•´è®¾è®¡æ–¹æ¡ˆï¼ˆé›†æˆæƒé™ä½“ç³»ç‰ˆï¼‰

## ä¸€ã€ç³»ç»Ÿæ¶æ„æ¦‚è¿°

æœ¬å¹³å°é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼ŒåŸºäºç°ä»£åŒ–æŠ€æœ¯æ ˆï¼Œæ”¯æŒé«˜å¹¶å‘ã€é«˜å¯ç”¨å’Œæ¨ªå‘æ‰©å±•ã€‚æ¶æ„ä¸¥æ ¼éµå¾ªå¾®æœåŠ¡çš„å•ä¸€èŒè´£åŸåˆ™ï¼Œç¡®ä¿æœåŠ¡è¾¹ç•Œæ¸…æ™°ã€æ•°æ®ç‹¬ç«‹ï¼Œå¹¶é›†æˆäº†å®Œå–„çš„ç¾¤ç»„æƒé™ç®¡ç†ä½“ç³»ã€‚

### æŠ€æœ¯æ ˆç»„åˆ
- **åç«¯æ¡†æ¶**: Flask (Python) + FastAPI (é«˜æ€§èƒ½å¼‚æ­¥æœåŠ¡)
- **å‰ç«¯æ¡†æ¶**: React + TypeScript + Socket.IO (å®æ—¶é€šä¿¡)
- **ä¸»æ•°æ®åº“**: MySQL 8.0 (å…³ç³»å‹æ•°æ®ï¼Œæ”¯æŒJSONå­—æ®µ)
- **æ–‡æ¡£å­˜å‚¨**: MongoDB (éç»“æ„åŒ–æ•°æ®)
- **ç¼“å­˜å±‚**: Redis Cluster (ç¼“å­˜ + ä¼šè¯ + åˆ†å¸ƒå¼é”)
- **æ¶ˆæ¯é˜Ÿåˆ—**: RabbitMQ (å¯é æ¶ˆæ¯ä¼ é€’)
- **å¯¹è±¡å­˜å‚¨**: MinIO (æ–‡ä»¶å­˜å‚¨)
- **æœç´¢å¼•æ“**: Elasticsearch (å…¨æ–‡æœç´¢ + åˆ†æ)
- **å®æ—¶é€šä¿¡**: Socket.IO + Redis Adapter
- **ç›‘æ§ç³»ç»Ÿ**: Prometheus + Grafana
- **æ—¥å¿—ç³»ç»Ÿ**: ELK Stack (Elasticsearch + Logstash + Kibana)

## äºŒã€å¾®æœåŠ¡æ¶æ„è®¾è®¡

### æœåŠ¡å±‚çº§åˆ’åˆ†

```
åŸºç¡€è®¾æ–½å±‚:
â”œâ”€â”€ APIç½‘å…³æœåŠ¡ (api-gateway)
â””â”€â”€ æœåŠ¡å‘ç° (service-discovery)

æ ¸å¿ƒä¸šåŠ¡å±‚:
â”œâ”€â”€ è®¤è¯æˆæƒæœåŠ¡ (auth-service)
â”œâ”€â”€ ç¾¤ç»„æœåŠ¡ (team-service)
â”œâ”€â”€ é¡¹ç›®æœåŠ¡ (project-service)
â””â”€â”€ æƒé™ç®¡ç†æœåŠ¡ (permission-service)

è®¾è®¡å·¥å…·å±‚:
â”œâ”€â”€ æ¶æ„è®¾è®¡æœåŠ¡ (architecture-service)
â”œâ”€â”€ æµç¨‹å›¾è®¾è®¡æœåŠ¡ (flow-diagram-service)
â”œâ”€â”€ APIè®¾è®¡æœåŠ¡ (api-design-service)
â”œâ”€â”€ æ•°æ®åº“è®¾è®¡æœåŠ¡ (db-design-service)
â””â”€â”€ åŠŸèƒ½å¯¼å›¾æœåŠ¡ (feature-map-service)

åä½œæ”¯æ’‘å±‚:
â”œâ”€â”€ å®æ—¶åä½œæœåŠ¡ (collaboration-service)
â”œâ”€â”€ ç‰ˆæœ¬æ§åˆ¶æœåŠ¡ (version-control-service)
â”œâ”€â”€ æ–‡ä»¶æœåŠ¡ (file-service)
â””â”€â”€ æœç´¢æœåŠ¡ (search-service)

åŸºç¡€æœåŠ¡å±‚:
â”œâ”€â”€ é›†æˆæœåŠ¡ (integration-service)
â”œâ”€â”€ é€šçŸ¥æœåŠ¡ (notification-service)
â””â”€â”€ å®¡è®¡æœåŠ¡ (audit-service)
```

## ä¸‰ã€æƒé™ä½“ç³»æ ¸å¿ƒè®¾è®¡

### 3.1 æƒé™ä½“ç³»æ¦‚è¿°

**æ ¸å¿ƒè®¾è®¡ç†å¿µ**:
- **ç¾¤ç»„ä¸ºä¸­å¿ƒ**: æ‰€æœ‰é¡¹ç›®éƒ½éš¶å±äºç¾¤ç»„ï¼Œé€šè¿‡ç¾¤ç»„ç®¡ç†é¡¹ç›®æƒé™
- **åˆ†çº§æƒé™**: å¹³å°ç®¡ç†å‘˜ > ç¾¤ä¸» > ç¾¤ç»„ç®¡ç†å‘˜ > é¡¹ç›®ç»´æŠ¤å‘˜ > ç¾¤ç»„æˆå‘˜ > å¤–éƒ¨ç”¨æˆ·
- **å¯è§æ€§æ§åˆ¶**: é¡¹ç›®æ”¯æŒå…¬å¼€/ç§å¯†ä¸¤ç§æ¨¡å¼
- **ç”³è¯·åˆ¶åº¦**: éç¾¤ç»„æˆå‘˜éœ€è¦ç”³è¯·åŠ å…¥æ‰èƒ½è®¿é—®ç§å¯†é¡¹ç›®

## æƒé™ä½“ç³»è®¾è®¡åŸåˆ™

### æƒé™å±‚çº§å®šä¹‰
```
å¹³å°å±‚çº§:
â”œâ”€â”€ å¹³å°ç®¡ç†å‘˜ (Platform Admin) - å¹³å°æœ€é«˜æƒé™
â””â”€â”€ å¹³å°ç”¨æˆ· (Platform User) - åŸºç¡€å¹³å°è®¿é—®æƒé™

ä¸šåŠ¡å±‚çº§:
â”œâ”€â”€ ç¾¤ä¸» (Team Owner) - ç¾¤ç»„æœ€é«˜æƒé™
â”œâ”€â”€ ç¾¤ç»„ç®¡ç†å‘˜ (Team Admin) - ç¾¤ç»„ç®¡ç†æƒé™
â”œâ”€â”€ é¡¹ç›®ç»´æŠ¤å‘˜ (Project Maintainer) - ç‰¹å®šé¡¹ç›®ç®¡ç†æƒé™
â”œâ”€â”€ ç¾¤ç»„æˆå‘˜ (Team Member) - ç¾¤ç»„åŸºç¡€æƒé™
â””â”€â”€ å¤–éƒ¨ç”¨æˆ· (External User) - æ— ç¾¤ç»„æƒé™
```

### 3.3 æƒé™æ§åˆ¶çŸ©é˜µ

#### ç¾¤ç»„çº§åˆ«æƒé™
| æ“ä½œ | ç¾¤ä¸» | ç¾¤ç»„ç®¡ç†å‘˜ | é¡¹ç›®ç»´æŠ¤å‘˜ | ç¾¤ç»„æˆå‘˜ | å¤–éƒ¨ç”¨æˆ· |
|------|------|------------|------------|----------|----------|
| æŸ¥çœ‹ç¾¤ç»„ä¿¡æ¯ | âœ… | âœ… | âœ… | âœ… | âŒ |
| ä¿®æ”¹ç¾¤ç»„è®¾ç½® | âœ… | âŒ | âŒ | âŒ | âŒ |
| åˆ é™¤ç¾¤ç»„ | âœ… | âŒ | âŒ | âŒ | âŒ |
| è½¬è®©ç¾¤ç»„æ‰€æœ‰æƒ | âœ… | âŒ | âŒ | âŒ | âŒ |
| æ·»åŠ /ç§»é™¤ç®¡ç†å‘˜ | âœ… | âŒ | âŒ | âŒ | âŒ |
| é‚€è¯·ç¾¤ç»„æˆå‘˜ | âœ… | âœ… | âŒ | âŒ | âŒ |
| ç§»é™¤ç¾¤ç»„æˆå‘˜ | âœ… | âœ… | âŒ | âŒ | âŒ |
| å®¡æ ¸åŠ å…¥ç”³è¯· | âœ… | âœ… | âŒ | âŒ | âŒ |
| æŸ¥çœ‹ç¾¤ç»„ç»Ÿè®¡ | âœ… | âœ… | âŒ | âŒ | âŒ |

#### é¡¹ç›®çº§åˆ«æƒé™
| æ“ä½œ | ç¾¤ä¸» | ç¾¤ç»„ç®¡ç†å‘˜ | é¡¹ç›®ç»´æŠ¤å‘˜ | ç¾¤ç»„æˆå‘˜ | å¤–éƒ¨ç”¨æˆ· |
|------|------|------------|------------|----------|----------|
| æŸ¥çœ‹å…¬å¼€é¡¹ç›®åˆ—è¡¨ | âœ… | âœ… | âœ… | âœ… | âœ… |
| æŸ¥çœ‹ç§å¯†é¡¹ç›®åˆ—è¡¨ | âœ… | âœ… | âœ… | âœ… | âŒ |
| åˆ›å»ºé¡¹ç›® | âœ… | âœ… | âŒ | âŒ | âŒ |
| æŸ¥çœ‹é¡¹ç›®è¯¦æƒ… | âœ… | âœ… | âœ…(æŒ‡å®šé¡¹ç›®) | âœ… | âœ…(ä»…å…¬å¼€é¡¹ç›®) |
| ç¼–è¾‘é¡¹ç›®è®¾ç½® | âœ… | âœ… | âœ…(æŒ‡å®šé¡¹ç›®) | âŒ | âŒ |
| åˆ é™¤é¡¹ç›® | âœ… | âœ… | âŒ | âŒ | âŒ |
| æŒ‡å®šé¡¹ç›®ç»´æŠ¤å‘˜ | âœ… | âœ… | âŒ | âŒ | âŒ |
| ä¿®æ”¹é¡¹ç›®å¯è§æ€§ | âœ… | âœ… | âŒ | âŒ | âŒ |

#### é¡¹ç›®å†…å®¹æƒé™
| æ“ä½œ | ç¾¤ä¸» | ç¾¤ç»„ç®¡ç†å‘˜ | é¡¹ç›®ç»´æŠ¤å‘˜ | ç¾¤ç»„æˆå‘˜ | å¤–éƒ¨ç”¨æˆ· |
|------|------|------------|------------|----------|----------|
| æŸ¥çœ‹è®¾è®¡å†…å®¹ | âœ… | âœ… | âœ…(æŒ‡å®šé¡¹ç›®) | âœ… | âœ…(ä»…å…¬å¼€é¡¹ç›®) |
| ç¼–è¾‘è®¾è®¡å†…å®¹ | âœ… | âœ… | âœ…(æŒ‡å®šé¡¹ç›®) | ğŸ“ | âŒ |
| åˆ›å»ºæ–°è®¾è®¡ | âœ… | âœ… | âœ…(æŒ‡å®šé¡¹ç›®) | ğŸ“ | âŒ |
| åˆ é™¤è®¾è®¡ | âœ… | âœ… | âœ…(æŒ‡å®šé¡¹ç›®) | âŒ | âŒ |
| è¯„è®ºå’Œè®¨è®º | âœ… | âœ… | âœ…(æŒ‡å®šé¡¹ç›®) | âœ… | âœ…(ä»…å…¬å¼€é¡¹ç›®) |
| æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ | âœ… | âœ… | âœ…(æŒ‡å®šé¡¹ç›®) | âœ… | âœ…(ä»…å…¬å¼€é¡¹ç›®) |
| ç‰ˆæœ¬ç®¡ç† | âœ… | âœ… | âœ…(æŒ‡å®šé¡¹ç›®) | ğŸ“ | âŒ |

ğŸ“ = éœ€è¦é¡¹ç›®è®¾ç½®ä¸­å¼€å¯"å…è®¸æˆå‘˜ç¼–è¾‘"é€‰é¡¹

### æƒé™ç»§æ‰¿è§„åˆ™
1. **å¹³å°æƒé™**: å¹³å°ç®¡ç†å‘˜æ‹¥æœ‰æ‰€æœ‰ç¾¤ç»„å’Œé¡¹ç›®çš„å®Œå…¨è®¿é—®æƒé™
2. **ç¾¤ç»„æƒé™**: ç¾¤ä¸» > ç¾¤ç»„ç®¡ç†å‘˜ > é¡¹ç›®ç»´æŠ¤å‘˜ > ç¾¤ç»„æˆå‘˜
3. **é¡¹ç›®æƒé™**: é¡¹ç›®ç»´æŠ¤å‘˜åœ¨æŒ‡å®šé¡¹ç›®ä¸­æ‹¥æœ‰ç¼–è¾‘æƒé™ï¼Œå…¶ä»–é¡¹ç›®ä»…æœ‰è¯»å–æƒé™
4. **è·¨ç¾¤ç»„ç‹¬ç«‹**: ç”¨æˆ·åœ¨ä¸åŒç¾¤ç»„ä¸­çš„è§’è‰²ç›¸äº’ç‹¬ç«‹

## æƒé™éªŒè¯æµç¨‹è®¾è®¡

### æƒé™éªŒè¯é€»è¾‘
```yaml
æƒé™éªŒè¯æ­¥éª¤:
  1. å¹³å°æƒé™æ£€æŸ¥:
     - å¦‚æœæ˜¯å¹³å°ç®¡ç†å‘˜ -> å…è®¸æ‰€æœ‰æ“ä½œ
     - å¦‚æœæ˜¯å¹³å°ç”¨æˆ· -> ç»§ç»­ä¸šåŠ¡æƒé™æ£€æŸ¥
     
  2. ç¾¤ç»„æƒé™æ£€æŸ¥:
     - è·å–ç”¨æˆ·åœ¨ç›®æ ‡ç¾¤ç»„ä¸­çš„è§’è‰²
     - å¦‚æœæ˜¯ç¾¤ä¸» -> å…è®¸ç¾¤ç»„å†…æ‰€æœ‰æ“ä½œ
     - å¦‚æœæ˜¯ç¾¤ç»„ç®¡ç†å‘˜ -> å…è®¸ç¾¤ç»„ç®¡ç†æ“ä½œï¼Œæ‰€æœ‰é¡¹ç›®è¯»å†™
     - å¦‚æœæ˜¯ç¾¤ç»„æˆå‘˜ -> ç»§ç»­é¡¹ç›®æƒé™æ£€æŸ¥
     - å¦‚æœä¸åœ¨ç¾¤ç»„å†… -> æ£€æŸ¥å…¬å¼€é¡¹ç›®è®¿é—®æƒé™
     
  3. é¡¹ç›®æƒé™æ£€æŸ¥:
     - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºé¡¹ç›®ç»´æŠ¤å‘˜
     - å¦‚æœæ˜¯ç»´æŠ¤å‘˜ -> å…è®¸è¯¥é¡¹ç›®çš„ç¼–è¾‘æ“ä½œ
     - å¦‚æœæ˜¯ç¾¤ç»„æˆå‘˜ -> æ ¹æ®é¡¹ç›®è®¾ç½®å…è®¸è¯»å–æˆ–ç¼–è¾‘
     - å¦‚æœæ˜¯å¤–éƒ¨ç”¨æˆ· -> ä»…å…è®¸å…¬å¼€é¡¹ç›®çš„æŸ¥çœ‹ï¼ˆæ ¹æ®é¡¹ç›®è®¾ç½®ï¼‰
     
  4. èµ„æºæƒé™æ£€æŸ¥:
     - åŸºäºé¡¹ç›®æƒé™ç»§æ‰¿èµ„æºè®¿é—®æƒé™
     - æ£€æŸ¥èµ„æºç‰¹å®šçš„è®¿é—®é™åˆ¶
```

### è·¨æœåŠ¡æƒé™åŒæ­¥
```yaml
æƒé™å˜æ›´åŒæ­¥æµç¨‹:
  1. ç¾¤ç»„è§’è‰²å˜æ›´:
     - ç¾¤ç»„æœåŠ¡æ›´æ–°æˆå‘˜è§’è‰²
     - é€šçŸ¥æƒé™æœåŠ¡åˆ·æ–°ç”¨æˆ·ä¸Šä¸‹æ–‡
     - æƒé™æœåŠ¡æ¸…é™¤ç›¸å…³ç¼“å­˜
     - å‘é€æƒé™å˜æ›´äº‹ä»¶
     
  2. é¡¹ç›®ç»´æŠ¤å‘˜å˜æ›´:
     - é¡¹ç›®æœåŠ¡æ›´æ–°ç»´æŠ¤å‘˜ä¿¡æ¯
     - é€šçŸ¥æƒé™æœåŠ¡åˆ·æ–°ç”¨æˆ·ä¸Šä¸‹æ–‡
     - æƒé™æœåŠ¡æ¸…é™¤ç›¸å…³ç¼“å­˜
     - å‘é€æƒé™å˜æ›´äº‹ä»¶
     
  3. å¹³å°è§’è‰²å˜æ›´:
     - è®¤è¯æœåŠ¡æ›´æ–°ç”¨æˆ·å¹³å°è§’è‰²
     - é€šçŸ¥æƒé™æœåŠ¡åˆ·æ–°ç”¨æˆ·ä¸Šä¸‹æ–‡
     - æƒé™æœåŠ¡æ¸…é™¤æ‰€æœ‰ç›¸å…³ç¼“å­˜
```

## æœåŠ¡é—´é›†æˆè®¾è®¡

### æƒé™éªŒè¯ä¸­é—´ä»¶
```yaml
APIç½‘å…³æƒé™éªŒè¯æµç¨‹:
  1. è§£æJWTä»¤ç‰Œè·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
  2. è°ƒç”¨æƒé™æœåŠ¡éªŒè¯æ“ä½œæƒé™
  3. æƒé™æœåŠ¡æ ¹æ®ç¼“å­˜æˆ–å®æ—¶æŸ¥è¯¢è¿”å›ç»“æœ
  4. ç½‘å…³å†³å®šæ˜¯å¦æ”¾è¡Œè¯·æ±‚
  5. åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ ç”¨æˆ·æƒé™ä¸Šä¸‹æ–‡
```

### ç¼“å­˜ç­–ç•¥
```yaml
æƒé™ç¼“å­˜å±‚çº§:
  L1_Cache (Redis):
    - ç”¨æˆ·æƒé™ä¸Šä¸‹æ–‡: TTL 30åˆ†é’Ÿ
    - æƒé™éªŒè¯ç»“æœ: TTL 15åˆ†é’Ÿ
    - ç¾¤ç»„æˆå‘˜è§’è‰²: TTL 1å°æ—¶
    - é¡¹ç›®ç»´æŠ¤å‘˜åˆ—è¡¨: TTL 1å°æ—¶
    
  L2_Cache (åº”ç”¨å†…å­˜):
    - æƒé™å®šä¹‰: TTL 24å°æ—¶
    - å¹³å°è§’è‰²: TTL 1å°æ—¶
    
  ç¼“å­˜å¤±æ•ˆç­–ç•¥:
    - è§’è‰²å˜æ›´æ—¶ç«‹å³å¤±æ•ˆç›¸å…³ç¼“å­˜
    - å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜
    - æ”¯æŒæ‰‹åŠ¨ç¼“å­˜åˆ·æ–°
```

### æ•°æ®ä¸€è‡´æ€§ä¿è¯
```yaml
ä¸€è‡´æ€§ç­–ç•¥:
  1. å¼ºä¸€è‡´æ€§åœºæ™¯:
     - æƒé™éªŒè¯æ“ä½œ
     - è§’è‰²åˆ†é…æ“ä½œ
     - æ•æ„Ÿèµ„æºè®¿é—®
     
  2. æœ€ç»ˆä¸€è‡´æ€§åœºæ™¯:
     - æƒé™ä¸Šä¸‹æ–‡ç¼“å­˜
     - æ´»åŠ¨è®°å½•åŒæ­¥
     - ç»Ÿè®¡æ•°æ®æ›´æ–°
     
  3. å†²çªè§£å†³:
     - ä»¥æ•°æ®åº“ä¸­çš„æœ€æ–°çŠ¶æ€ä¸ºå‡†
     - æä¾›æ‰‹åŠ¨æ•°æ®ä¿®å¤æ¥å£
     - è®°å½•å†²çªæ—¥å¿—ä¾¿äºæ’æŸ¥
```

## æƒé™æ§åˆ¶å…·ä½“è§„åˆ™

### ç¾¤ç»„æƒé™è§„åˆ™
```yaml
ç¾¤ä¸»æƒé™:
  - æ›´æ–°ç¾¤ç»„ä¿¡æ¯
  - è½¬è®©ç¾¤ç»„æ‰€æœ‰æƒ
  - æ·»åŠ /ç§»é™¤ç¾¤ç»„ç®¡ç†å‘˜
  - é‚€è¯·/ç§»é™¤æˆå‘˜
  - å®¡æ ¸åŠ å…¥ç”³è¯·
  - åˆ›å»º/åˆ é™¤é¡¹ç›®
  - æŒ‡å®š/ç§»é™¤é¡¹ç›®ç»´æŠ¤å‘˜
  - ç¼–è¾‘æ‰€æœ‰é¡¹ç›®

ç¾¤ç»„ç®¡ç†å‘˜æƒé™:
  - é‚€è¯·/ç§»é™¤æˆå‘˜
  - å®¡æ ¸åŠ å…¥ç”³è¯·
  - åˆ›å»ºé¡¹ç›®
  - æŒ‡å®š/ç§»é™¤é¡¹ç›®ç»´æŠ¤å‘˜
  - ç¼–è¾‘æ‰€æœ‰é¡¹ç›®

ç¾¤ç»„æˆå‘˜æƒé™:
  - æŸ¥çœ‹ç¾¤ç»„ä¿¡æ¯
  - æŸ¥çœ‹æ‰€æœ‰é¡¹ç›®
  - ç¼–è¾‘æƒé™æ ¹æ®é¡¹ç›®è®¾ç½®å†³å®š
```

### é¡¹ç›®æƒé™è§„åˆ™
```yaml
é¡¹ç›®ç»´æŠ¤å‘˜æƒé™:
  - ç¼–è¾‘æŒ‡å®šé¡¹ç›®çš„æ‰€æœ‰å†…å®¹
  - ç®¡ç†é¡¹ç›®è®¾ç½®
  - æŸ¥çœ‹é¡¹ç›®ç»Ÿè®¡
  - ç®¡ç†é¡¹ç›®æ ‡ç­¾

æ™®é€šæˆå‘˜æƒé™:
  - æŸ¥çœ‹é¡¹ç›®å†…å®¹
  - ç¼–è¾‘æƒé™æ ¹æ®é¡¹ç›®allow_member_editè®¾ç½®

å¤–éƒ¨ç”¨æˆ·æƒé™:
  - ä»…èƒ½è®¿é—®å…¬å¼€é¡¹ç›®
  - è®¿é—®æƒé™å—é¡¹ç›®å¤–éƒ¨è®¿é—®è®¾ç½®é™åˆ¶
```

### æƒé™ç»§æ‰¿è§„åˆ™
```yaml
ç»§æ‰¿å±‚çº§:
  å¹³å°ç®¡ç†å‘˜ -> æ‰€æœ‰ç¾¤ç»„å’Œé¡¹ç›®çš„å®Œå…¨æƒé™
  ç¾¤ä¸» -> ç¾¤ç»„å†…æ‰€æœ‰é¡¹ç›®çš„å®Œå…¨æƒé™
  ç¾¤ç»„ç®¡ç†å‘˜ -> ç¾¤ç»„å†…æ‰€æœ‰é¡¹ç›®çš„ç¼–è¾‘æƒé™
  é¡¹ç›®ç»´æŠ¤å‘˜ -> æŒ‡å®šé¡¹ç›®çš„ç¼–è¾‘æƒé™
  ç¾¤ç»„æˆå‘˜ -> é¡¹ç›®è¯»å–æƒé™ï¼Œç¼–è¾‘æƒé™æ ¹æ®é¡¹ç›®è®¾ç½®

ç‰¹æ®Šè§„åˆ™:
  - é¡¹ç›®ç»´æŠ¤å‘˜æƒé™ä¸èƒ½è¶…è¶Šç¾¤ç»„è§’è‰²æƒé™
  - å¹³å°ç®¡ç†å‘˜æƒé™å¯ä»¥è¦†ç›–æ‰€æœ‰ä¸šåŠ¡æƒé™
  - ç”¨æˆ·åœ¨å¤šä¸ªç¾¤ç»„ä¸­çš„è§’è‰²ç›¸äº’ç‹¬ç«‹
```

## å®‰å…¨è€ƒè™‘

### æƒé™æå‡é˜²æŠ¤
```yaml
é˜²æŠ¤æªæ–½:
  1. è§’è‰²æå‡é™åˆ¶:
     - åªæœ‰ç¾¤ä¸»å¯ä»¥æŒ‡å®šç®¡ç†å‘˜
     - åªæœ‰ç¾¤ä¸»/ç®¡ç†å‘˜å¯ä»¥æŒ‡å®šé¡¹ç›®ç»´æŠ¤å‘˜
     - å¹³å°è§’è‰²åªèƒ½ç”±å¹³å°ç®¡ç†å‘˜ä¿®æ”¹
     
  2. æƒé™éªŒè¯:
     - æ¯æ¬¡æ“ä½œéƒ½è¿›è¡Œå®æ—¶æƒé™éªŒè¯
     - ä¸ä¾èµ–å®¢æˆ·ç«¯æƒé™åˆ¤æ–­
     - è®°å½•æ‰€æœ‰æƒé™ç›¸å…³æ“ä½œ
     
  3. å¼‚å¸¸æ£€æµ‹:
     - ç›‘æ§å¼‚å¸¸æƒé™ä½¿ç”¨æ¨¡å¼
     - æ£€æµ‹æƒé™æå‡å°è¯•
     - è‡ªåŠ¨é”å®šå¯ç–‘è´¦æˆ·
```

### æ•°æ®éš”ç¦»
```yaml
éš”ç¦»ç­–ç•¥:
  1. ç¾¤ç»„çº§éš”ç¦»:
     - ä¸åŒç¾¤ç»„æ•°æ®å®Œå…¨éš”ç¦»
     - è·¨ç¾¤ç»„æ“ä½œéœ€è¦æ˜ç¡®æˆæƒ
     - ç¾¤ç»„åˆ é™¤æ—¶æ¸…ç†æ‰€æœ‰ç›¸å…³æ•°æ®
     
  2. é¡¹ç›®çº§éš”ç¦»:
     - ç§å¯†é¡¹ç›®å¯¹å¤–ä¸å¯è§
     - é¡¹ç›®æ•°æ®è®¿é—®éœ€è¦æƒé™éªŒè¯
     - æ”¯æŒé¡¹ç›®çº§æ•°æ®å¯¼å‡º
     
  3. ç”¨æˆ·çº§éš”ç¦»:
     - ç”¨æˆ·åªèƒ½è®¿é—®æœ‰æƒé™çš„èµ„æº
     - ä¸ªäººæ•°æ®ä¸ä¸šåŠ¡æ•°æ®åˆ†ç¦»
     - æ”¯æŒç”¨æˆ·æ•°æ®åˆ é™¤æƒåˆ©
```

## å®æ–½å»ºè®®

### è¿ç§»ç­–ç•¥
```yaml
ç°æœ‰ç³»ç»Ÿè¿ç§»:
  Phase 1: å¹³å°æƒé™è¿ç§»
    - è¯†åˆ«ç°æœ‰å¹³å°ç®¡ç†å‘˜
    - æ›´æ–°ç”¨æˆ·è¡¨æ·»åŠ å¹³å°è§’è‰²å­—æ®µ
    - éƒ¨ç½²è®¤è¯æœåŠ¡æƒé™æ£€æŸ¥
    
  Phase 2: ç¾¤ç»„æƒé™è¿ç§»
    - ä¸ºç°æœ‰é¡¹ç›®åˆ›å»ºå¯¹åº”ç¾¤ç»„
    - é¡¹ç›®åˆ›å»ºè€…è‡ªåŠ¨æˆä¸ºç¾¤ä¸»
    - è¿ç§»ç°æœ‰æˆå‘˜å…³ç³»
    
  Phase 3: é¡¹ç›®æƒé™ç»†åŒ–
    - è¯†åˆ«é¡¹ç›®ç»´æŠ¤è€…
    - å»ºç«‹é¡¹ç›®ç»´æŠ¤å‘˜å…³ç³»
    - æ›´æ–°é¡¹ç›®æƒé™è®¾ç½®
    
  Phase 4: æƒé™æœåŠ¡éƒ¨ç½²
    - éƒ¨ç½²æƒé™ç®¡ç†æœåŠ¡
    - æ„å»ºæƒé™ä¸Šä¸‹æ–‡ç¼“å­˜
    - å¯ç”¨ç»Ÿä¸€æƒé™éªŒè¯
```

### æ€§èƒ½ä¼˜åŒ–
```yaml
ä¼˜åŒ–ç­–ç•¥:
  1. ç¼“å­˜ä¼˜åŒ–:
     - æƒé™ä¸Šä¸‹æ–‡é¢„è®¡ç®—
     - çƒ­ç‚¹æƒé™æ•°æ®å¸¸é©»å†…å­˜
     - åˆ†å¸ƒå¼ç¼“å­˜ä¸€è‡´æ€§ä¿è¯
     
  2. æŸ¥è¯¢ä¼˜åŒ–:
     - æƒé™ç›¸å…³æŸ¥è¯¢ç´¢å¼•ä¼˜åŒ–
     - æ‰¹é‡æƒé™éªŒè¯æ¥å£
     - å‡å°‘è·¨æœåŠ¡è°ƒç”¨
     
  3. å¼‚æ­¥å¤„ç†:
     - æƒé™å˜æ›´äº‹ä»¶å¼‚æ­¥å¤„ç†
     - ç¼“å­˜æ›´æ–°å¼‚æ­¥æ‰§è¡Œ
     - éå…³é”®æƒé™æ£€æŸ¥å¼‚æ­¥éªŒè¯
```

### ç›‘æ§å’Œå‘Šè­¦
```yaml
ç›‘æ§æŒ‡æ ‡:
  æƒé™ç›¸å…³:
    - æƒé™éªŒè¯æˆåŠŸç‡
    - æƒé™éªŒè¯å“åº”æ—¶é—´
    - æƒé™æ‹’ç»ç‡ç»Ÿè®¡
    - ç¼“å­˜å‘½ä¸­ç‡
    
  å®‰å…¨ç›¸å…³:
    - æƒé™æå‡å°è¯•æ¬¡æ•°
    - å¼‚å¸¸æƒé™ä½¿ç”¨æ¨¡å¼
    - æœªæˆæƒè®¿é—®å°è¯•
    - æƒé™æ³„éœ²é£é™©è¯„ä¼°
    
  æ€§èƒ½ç›¸å…³:
    - è·¨æœåŠ¡è°ƒç”¨å»¶è¿Ÿ
    - æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
    - ç¼“å­˜ä½¿ç”¨æ•ˆç‡
    - ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡

å‘Šè­¦è§„åˆ™:
  Critical:
    - æƒé™ç³»ç»Ÿä¸å¯ç”¨
    - å¤§é‡æƒé™éªŒè¯å¤±è´¥
    - æ£€æµ‹åˆ°æƒé™æå‡æ”»å‡»
    
  Warning:
    - æƒé™éªŒè¯å»¶è¿Ÿè¿‡é«˜
    - ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™
    - å¼‚å¸¸æƒé™ä½¿ç”¨æ¨¡å¼
```

## å››ã€è¯¦ç»†æœåŠ¡è®¾è®¡

### 1. APIç½‘å…³æœåŠ¡ (api-gateway)
**èŒè´£**: ç»Ÿä¸€å…¥å£ã€è·¯ç”±è½¬å‘ã€ä»¤ç‰ŒéªŒè¯ã€é™æµç†”æ–­ã€è¯·æ±‚èšåˆã€æƒé™é¢„æ£€

#### æ•°æ®åº“è®¾è®¡ (MySQL)
```sql
-- APIè·¯ç”±é…ç½®è¡¨
CREATE TABLE api_routes (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    service_name VARCHAR(100) NOT NULL,
    path_pattern VARCHAR(500) NOT NULL,
    target_url VARCHAR(500) NOT NULL,
    method VARCHAR(10) NOT NULL,
    version VARCHAR(20) DEFAULT 'v1',
    is_active BOOLEAN DEFAULT TRUE,
    requires_auth BOOLEAN DEFAULT TRUE,
    required_permissions JSON, -- éœ€è¦çš„æƒé™åˆ—è¡¨
    permission_check_strategy ENUM('any', 'all') DEFAULT 'any',
    rate_limit_rpm INT DEFAULT 1000,
    timeout_seconds INT DEFAULT 30,
    retry_count INT DEFAULT 3,
    circuit_breaker_enabled BOOLEAN DEFAULT TRUE,
    cache_enabled BOOLEAN DEFAULT FALSE,
    cache_ttl_seconds INT DEFAULT 300,
    load_balance_strategy ENUM('round_robin', 'weighted', 'least_connections') DEFAULT 'round_robin',
    priority INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_path_method (path_pattern, method),
    INDEX idx_service (service_name),
    INDEX idx_active (is_active),
    INDEX idx_priority (priority DESC)
);

-- æœåŠ¡å®ä¾‹è¡¨
CREATE TABLE service_instances (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    service_name VARCHAR(100) NOT NULL,
    instance_id VARCHAR(100) NOT NULL,
    host VARCHAR(255) NOT NULL,
    port INT NOT NULL,
    protocol ENUM('http', 'https') DEFAULT 'http',
    weight INT DEFAULT 100,
    status ENUM('healthy', 'unhealthy', 'draining') DEFAULT 'healthy',
    last_health_check TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    health_check_url VARCHAR(500),
    health_check_interval_seconds INT DEFAULT 30,
    metadata JSON,
    registered_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE(service_name, instance_id),
    INDEX idx_service_status (service_name, status),
    INDEX idx_health_check (last_health_check)
);

-- APIé™æµè®°å½•è¡¨
CREATE TABLE rate_limit_records (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    identifier VARCHAR(255) NOT NULL,
    identifier_type ENUM('user', 'ip', 'api_key') NOT NULL,
    endpoint VARCHAR(500) NOT NULL,
    request_count INT DEFAULT 1,
    window_start TIMESTAMP NOT NULL,
    window_end TIMESTAMP NOT NULL,
    is_blocked BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_identifier_endpoint_window (identifier, endpoint, window_start),
    INDEX idx_window_end (window_end)
);

-- APIè°ƒç”¨æ—¥å¿—è¡¨
CREATE TABLE api_call_logs (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    request_id VARCHAR(36) UNIQUE NOT NULL,
    user_id VARCHAR(36),
    method VARCHAR(10) NOT NULL,
    path VARCHAR(1000) NOT NULL,
    query_params JSON,
    headers JSON,
    ip_address VARCHAR(45),
    user_agent TEXT,
    target_service VARCHAR(100),
    response_status INT,
    response_size BIGINT,
    response_time_ms INT,
    error_message TEXT,
    permission_check_result JSON, -- æƒé™æ£€æŸ¥ç»“æœ
    started_at TIMESTAMP(3) DEFAULT CURRENT_TIMESTAMP(3),
    completed_at TIMESTAMP(3),
    
    INDEX idx_path (path(255)),
    INDEX idx_status (response_status),
    INDEX idx_service (target_service),
    INDEX idx_user (user_id),
    INDEX idx_started_at (started_at),
    INDEX idx_response_time (response_time_ms)
);
```

#### æ¥å£è®¾è®¡
```yaml
# åŸºç¡€è®¾æ–½æ¥å£
GET /health                    # å¥åº·æ£€æŸ¥
GET /metrics                   # ç›‘æ§æŒ‡æ ‡ï¼ˆPrometheusæ ¼å¼ï¼‰
GET /admin/routes              # è·å–è·¯ç”±é…ç½®ï¼ˆç®¡ç†æ¥å£ï¼‰
POST /admin/routes             # æ›´æ–°è·¯ç”±é…ç½®ï¼ˆç®¡ç†æ¥å£ï¼‰
GET /admin/services            # è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼ˆç®¡ç†æ¥å£ï¼‰
GET /admin/permissions         # è·å–æƒé™é…ç½®ï¼ˆç®¡ç†æ¥å£ï¼‰

# æ‰€æœ‰ä¸šåŠ¡è¯·æ±‚éƒ½é€šè¿‡è·¯ç”±è½¬å‘
/*                            # æ™ºèƒ½è·¯ç”±è½¬å‘åˆ°å¯¹åº”å¾®æœåŠ¡
```

### 2. è®¤è¯æˆæƒæœåŠ¡ (auth-service)

**èŒè´£**: ç”¨æˆ·ç®¡ç†ã€ä»¤ç‰Œç®¡ç†ã€å¤šå› å­è®¤è¯ã€**å¹³å°çº§æƒé™ç®¡ç†**

### æ•°æ®åº“è®¾è®¡ (MySQL)
```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    username VARCHAR(255) UNIQUE NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    salt VARCHAR(255) NOT NULL,
    avatar_url VARCHAR(255),
    display_name VARCHAR(255),
    status ENUM('active', 'inactive', 'suspended', 'pending_verification') DEFAULT 'pending_verification',
    email_verified BOOLEAN DEFAULT FALSE,
    email_verification_token VARCHAR(255),
    email_verification_expires TIMESTAMP NULL,
    phone VARCHAR(20),
    phone_verified BOOLEAN DEFAULT FALSE,
    timezone VARCHAR(50) DEFAULT 'UTC',
    language VARCHAR(10) DEFAULT 'en',
    last_login_at TIMESTAMP NULL,
    last_login_ip VARCHAR(45),
    failed_login_attempts INT DEFAULT 0,
    locked_until TIMESTAMP NULL,
    password_reset_token VARCHAR(255),
    password_reset_expires TIMESTAMP NULL,
    two_factor_enabled BOOLEAN DEFAULT FALSE,
    two_factor_secret VARCHAR(255),
    backup_codes JSON,
    preferences JSON,
    -- æ–°å¢å¹³å°çº§æƒé™å­—æ®µ
    platform_role ENUM('platform_admin', 'platform_user') DEFAULT 'platform_user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_email (email),
    INDEX idx_username (username),
    INDEX idx_status (status),
    INDEX idx_platform_role (platform_role),
    INDEX idx_verification_token (email_verification_token),
    INDEX idx_reset_token (password_reset_token)
);

-- ç”¨æˆ·ä¼šè¯è¡¨
CREATE TABLE user_sessions (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    user_id VARCHAR(36) NOT NULL,
    session_token VARCHAR(255) UNIQUE NOT NULL,
    refresh_token_hash VARCHAR(255) NOT NULL,
    device_info JSON,
    ip_address VARCHAR(45),
    user_agent TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    expires_at TIMESTAMP NOT NULL,
    last_activity TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user (user_id),
    INDEX idx_session_token (session_token),
    INDEX idx_refresh_token (refresh_token_hash),
    INDEX idx_expires (expires_at),
    INDEX idx_active (is_active)
);

-- ç™»å½•å°è¯•è®°å½•è¡¨
CREATE TABLE login_attempts (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    email VARCHAR(255),
    username VARCHAR(255),
    ip_address VARCHAR(45) NOT NULL,
    user_agent TEXT,
    success BOOLEAN NOT NULL,
    failure_reason VARCHAR(100),
    attempted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_email (email),
    INDEX idx_ip (ip_address),
    INDEX idx_attempted_at (attempted_at),
    INDEX idx_success (success)
);

-- OAuthæä¾›å•†è¡¨
CREATE TABLE oauth_providers (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    name VARCHAR(100) UNIQUE NOT NULL,
    client_id VARCHAR(255) NOT NULL,
    client_secret_encrypted VARCHAR(500) NOT NULL,
    authorization_url VARCHAR(500) NOT NULL,
    token_url VARCHAR(500) NOT NULL,
    user_info_url VARCHAR(500) NOT NULL,
    scope VARCHAR(255) DEFAULT 'email profile',
    is_enabled BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- ç”¨æˆ·OAuthå…³è”è¡¨
CREATE TABLE user_oauth_accounts (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    user_id VARCHAR(36) NOT NULL,
    provider_id VARCHAR(36) NOT NULL,
    provider_user_id VARCHAR(255) NOT NULL,
    email VARCHAR(255),
    display_name VARCHAR(255),
    avatar_url VARCHAR(255),
    access_token_encrypted VARCHAR(1000),
    refresh_token_encrypted VARCHAR(1000),
    token_expires_at TIMESTAMP,
    connected_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_used_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE(provider_id, provider_user_id),
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (provider_id) REFERENCES oauth_providers(id) ON DELETE CASCADE,
    INDEX idx_user (user_id),
    INDEX idx_provider_user (provider_id, provider_user_id)
);
```

### æ¥å£è®¾è®¡
```yaml
# ç”¨æˆ·è®¤è¯
POST /auth/register            # ç”¨æˆ·æ³¨å†Œ
POST /auth/login               # ç”¨æˆ·ç™»å½•
POST /auth/logout              # ç”¨æˆ·ç™»å‡º
POST /auth/refresh             # åˆ·æ–°ä»¤ç‰Œ

# æ³¨å†Œè¾…åŠ©éªŒè¯
GET /auth/check-username/{username} # æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å¯ç”¨
GET /auth/check-email/{email}       # æ£€æŸ¥é‚®ç®±æ˜¯å¦å¯ç”¨

# å¯†ç ç®¡ç†
POST /auth/forgot-password     # å¿˜è®°å¯†ç 
POST /auth/reset-password      # é‡ç½®å¯†ç 
PUT /auth/change-password      # ä¿®æ”¹å¯†ç 

# ç”¨æˆ·ä¿¡æ¯ç®¡ç†
GET /auth/profile              # è·å–ç”¨æˆ·ä¿¡æ¯
PUT /auth/profile              # æ›´æ–°ç”¨æˆ·ä¿¡æ¯
GET /auth/sessions             # è·å–ç”¨æˆ·ä¼šè¯åˆ—è¡¨
DELETE /auth/sessions/{id}     # ç»ˆæ­¢æŒ‡å®šä¼šè¯

# é‚®ç®±éªŒè¯
POST /auth/send-verification   # å‘é€éªŒè¯é‚®ä»¶
POST /auth/verify-email        # éªŒè¯é‚®ç®±

# å¤šå› å­è®¤è¯
POST /auth/2fa/setup           # è®¾ç½®2FA
POST /auth/2fa/verify          # éªŒè¯2FA
POST /auth/2fa/disable         # ç¦ç”¨2FA
GET /auth/2fa/backup-codes     # è·å–å¤‡ç”¨ç 

# OAuth
GET /auth/oauth/{provider}/url # è·å–OAuthæˆæƒURL
POST /auth/oauth/{provider}/callback # OAuthå›è°ƒå¤„ç†

# å¹³å°æƒé™ç®¡ç†ï¼ˆä»…å¹³å°ç®¡ç†å‘˜ï¼‰
GET /auth/admin/users          # è·å–ç”¨æˆ·åˆ—è¡¨
PUT /auth/admin/users/{user_id}/platform-role # æ›´æ–°ç”¨æˆ·å¹³å°è§’è‰²
POST /auth/admin/users/{user_id}/suspend # æš‚åœç”¨æˆ·
POST /auth/admin/users/{user_id}/activate # æ¿€æ´»ç”¨æˆ·

# å†…éƒ¨æœåŠ¡æ¥å£
POST /internal/validate-token  # éªŒè¯ä»¤ç‰Œ
GET /internal/user/{user_id}   # è·å–ç”¨æˆ·ä¿¡æ¯
GET /internal/user/batch       # æ‰¹é‡è·å–ç”¨æˆ·ä¿¡æ¯
POST /internal/check-platform-permission # æ£€æŸ¥å¹³å°æƒé™
```

### è¯¦ç»†æ¥å£è¯´æ˜

#### æ³¨å†Œè¾…åŠ©éªŒè¯æ¥å£

**1. æ£€æŸ¥ç”¨æˆ·åå¯ç”¨æ€§**
```yaml
æ¥å£: GET /auth/check-username/{username}
æè¿°: å®æ—¶æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²è¢«å ç”¨ï¼Œç”¨äºæ³¨å†Œé¡µé¢çš„ç”¨æˆ·ä½“éªŒä¼˜åŒ–
è®¤è¯: æ— éœ€è®¤è¯ï¼ˆå…¬å¼€æ¥å£ï¼‰
å‚æ•°:
  - username (è·¯å¾„å‚æ•°): å¾…æ£€æŸ¥çš„ç”¨æˆ·å
å“åº”:
  æˆåŠŸ (200):
    {
      "available": true,              # æ˜¯å¦å¯ç”¨
      "suggestions": ["user123", "user456"]  # å¯é€‰ï¼šå½“ä¸å¯ç”¨æ—¶æä¾›å»ºè®®ç”¨æˆ·å
    }
  å¤±è´¥ (400):
    {
      "available": false,
      "message": "ç”¨æˆ·åæ ¼å¼ä¸æ­£ç¡®"
    }
éªŒè¯è§„åˆ™:
  - ç”¨æˆ·åé•¿åº¦: 3-20ä¸ªå­—ç¬¦
  - å…è®¸å­—ç¬¦: å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
  - ä¸èƒ½ä»¥æ•°å­—å¼€å¤´
  - ä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦
é™æµ: åŒä¸€IPæ¯åˆ†é’Ÿæœ€å¤š60æ¬¡è¯·æ±‚
ç¼“å­˜ç­–ç•¥: Redisç¼“å­˜5åˆ†é’Ÿï¼Œå‡è½»æ•°æ®åº“å‹åŠ›
```

**2. æ£€æŸ¥é‚®ç®±å¯ç”¨æ€§**
```yaml
æ¥å£: GET /auth/check-email/{email}
æè¿°: å®æ—¶æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²è¢«æ³¨å†Œï¼Œç”¨äºæ³¨å†Œé¡µé¢çš„ç”¨æˆ·ä½“éªŒä¼˜åŒ–
è®¤è¯: æ— éœ€è®¤è¯ï¼ˆå…¬å¼€æ¥å£ï¼‰
å‚æ•°:
  - email (è·¯å¾„å‚æ•°): å¾…æ£€æŸ¥çš„é‚®ç®±åœ°å€ï¼ˆéœ€URLç¼–ç ï¼‰
å“åº”:
  æˆåŠŸ (200):
    {
      "available": true,              # æ˜¯å¦å¯ç”¨
      "message": "è¯¥é‚®ç®±å¯ä»¥ä½¿ç”¨"     # å¯é€‰æç¤ºä¿¡æ¯
    }
  å¤±è´¥ (400):
    {
      "available": false,
      "message": "è¯¥é‚®ç®±å·²è¢«æ³¨å†Œ"
    }
éªŒè¯è§„åˆ™:
  - å¿…é¡»æ˜¯æœ‰æ•ˆçš„é‚®ç®±æ ¼å¼
  - ä¸å…è®¸ä¸´æ—¶é‚®ç®±æœåŠ¡ï¼ˆå¯é…ç½®é»‘åå•ï¼‰
  - åŒºåˆ†å¤§å°å†™å¤„ç†ï¼šç»Ÿä¸€è½¬å°å†™æ¯”å¯¹
é™æµ: åŒä¸€IPæ¯åˆ†é’Ÿæœ€å¤š60æ¬¡è¯·æ±‚
ç¼“å­˜ç­–ç•¥: Redisç¼“å­˜5åˆ†é’Ÿï¼Œå‡è½»æ•°æ®åº“å‹åŠ›
å®‰å…¨è€ƒè™‘:
  - é˜²æ­¢é‚®ç®±æšä¸¾æ”»å‡»ï¼šé™åˆ¶è¯·æ±‚é¢‘ç‡
  - å¯é€‰ï¼šå¯¹å·²æ³¨å†Œé‚®ç®±è¿”å›æ¨¡ç³Šæç¤º
```

### 3. æƒé™ç®¡ç†æœåŠ¡ (permission-service)

**èŒè´£**: ç»Ÿä¸€æƒé™éªŒè¯ã€æƒé™ç¼“å­˜ã€æƒé™ä¸Šä¸‹æ–‡ç®¡ç†

### æ•°æ®åº“è®¾è®¡ (MySQL)
```sql
-- æƒé™å®šä¹‰è¡¨
CREATE TABLE permissions (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    name VARCHAR(100) UNIQUE NOT NULL,
    description TEXT,
    resource_type VARCHAR(50) NOT NULL, -- 'platform', 'team', 'project', 'resource'
    action VARCHAR(50) NOT NULL, -- 'read', 'write', 'admin', 'delete', 'invite', etc.
    scope ENUM('platform', 'team', 'project', 'resource') NOT NULL,
    is_system_permission BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_resource_action (resource_type, action),
    INDEX idx_scope (scope),
    INDEX idx_system (is_system_permission)
);

-- ç”¨æˆ·æƒé™ä¸Šä¸‹æ–‡ç¼“å­˜è¡¨
CREATE TABLE user_permission_context (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    user_id VARCHAR(36) NOT NULL,
    platform_role ENUM('platform_admin', 'platform_user') NOT NULL,
    team_roles JSON, -- {"team_id": "role", ...}
    project_maintainer_roles JSON, -- {"project_id": "maintainer", ...}
    cached_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP NOT NULL,
    
    UNIQUE(user_id),
    INDEX idx_user (user_id),
    INDEX idx_expires (expires_at)
);

-- æƒé™éªŒè¯ç¼“å­˜è¡¨
CREATE TABLE permission_verification_cache (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    user_id VARCHAR(36) NOT NULL,
    resource_type VARCHAR(50) NOT NULL,
    resource_id VARCHAR(36) NOT NULL,
    action VARCHAR(50) NOT NULL,
    has_permission BOOLEAN NOT NULL,
    verification_context JSON, -- æƒé™éªŒè¯çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
    cached_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP NOT NULL,
    
    UNIQUE(user_id, resource_type, resource_id, action),
    INDEX idx_user_resource (user_id, resource_type, resource_id),
    INDEX idx_expires (expires_at)
);

-- æƒé™å˜æ›´äº‹ä»¶è¡¨
CREATE TABLE permission_change_events (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    event_type ENUM('user_role_changed', 'team_member_changed', 'project_maintainer_changed') NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    resource_type VARCHAR(50) NOT NULL,
    resource_id VARCHAR(36) NOT NULL,
    old_role VARCHAR(50),
    new_role VARCHAR(50),
    changed_by VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_user (user_id),
    INDEX idx_resource (resource_type, resource_id),
    INDEX idx_created_at (created_at)
);
```

### æ¥å£è®¾è®¡
```yaml
# æƒé™éªŒè¯
POST /permissions/verify           # éªŒè¯å•ä¸ªæƒé™
POST /permissions/verify-batch     # æ‰¹é‡éªŒè¯æƒé™
POST /permissions/verify-context   # åŸºäºç”¨æˆ·ä¸Šä¸‹æ–‡éªŒè¯æƒé™

# æƒé™ä¸Šä¸‹æ–‡ç®¡ç†
GET /permissions/context/{user_id} # è·å–ç”¨æˆ·æƒé™ä¸Šä¸‹æ–‡
POST /permissions/context/refresh  # åˆ·æ–°ç”¨æˆ·æƒé™ä¸Šä¸‹æ–‡
DELETE /permissions/context/clear  # æ¸…é™¤æƒé™ä¸Šä¸‹æ–‡ç¼“å­˜

# æƒé™æŸ¥è¯¢
GET /permissions/user/{user_id}/teams    # è·å–ç”¨æˆ·çš„ç¾¤ç»„è§’è‰²
GET /permissions/user/{user_id}/projects # è·å–ç”¨æˆ·çš„é¡¹ç›®ç»´æŠ¤æƒé™
GET /permissions/effective/{user_id}     # è·å–ç”¨æˆ·æœ‰æ•ˆæƒé™åˆ—è¡¨

# æƒé™äº‹ä»¶å¤„ç†
POST /permissions/events/team-role-changed      # å¤„ç†ç¾¤ç»„è§’è‰²å˜æ›´
POST /permissions/events/project-maintainer-changed # å¤„ç†é¡¹ç›®ç»´æŠ¤å‘˜å˜æ›´
POST /permissions/events/user-platform-role-changed # å¤„ç†å¹³å°è§’è‰²å˜æ›´

# ç¼“å­˜ç®¡ç†
GET /permissions/cache/stats       # è·å–ç¼“å­˜ç»Ÿè®¡
POST /permissions/cache/invalidate # ä½¿ç¼“å­˜å¤±æ•ˆ
POST /permissions/cache/warm-up    # é¢„çƒ­ç¼“å­˜

# å†…éƒ¨æ¥å£
POST /internal/permissions/verify  # å†…éƒ¨æƒé™éªŒè¯
POST /internal/permissions/build-context # æ„å»ºç”¨æˆ·æƒé™ä¸Šä¸‹æ–‡
POST /internal/permissions/notify-change # é€šçŸ¥æƒé™å˜æ›´
```

### 4. ç¾¤ç»„æœåŠ¡ (team-service)

**èŒè´£**: ç¾¤ç»„ç®¡ç†ã€æˆå‘˜ç®¡ç†ã€ç¾¤ç»„å†…è§’è‰²åˆ†é…

### æ•°æ®åº“è®¾è®¡ (MySQL)
```sql
-- ç¾¤ç»„è¡¨
CREATE TABLE teams (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    avatar_url VARCHAR(255),
    visibility ENUM('public', 'private', 'internal') NOT NULL DEFAULT 'private',
    max_members INT DEFAULT 100,
    settings JSON, -- ç¾¤ç»„é…ç½®ä¿¡æ¯
    auto_approve_join BOOLEAN DEFAULT FALSE,
    allow_member_invite BOOLEAN DEFAULT FALSE,
    require_approval_for_projects BOOLEAN DEFAULT TRUE,
    default_project_visibility ENUM('public', 'private') DEFAULT 'private',
    created_by VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_creator (created_by),
    INDEX idx_visibility (visibility),
    INDEX idx_name (name),
    FULLTEXT INDEX ft_name_desc (name, description)
);

-- ç¾¤ç»„æˆå‘˜è¡¨
CREATE TABLE team_members (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    team_id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    role ENUM('owner', 'admin', 'member') NOT NULL DEFAULT 'member',
    custom_permissions JSON, -- è‡ªå®šä¹‰æƒé™æ‰©å±•ï¼Œé¢„ç•™å­—æ®µ
    invited_by VARCHAR(36),
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_active_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE(team_id, user_id),
    INDEX idx_team (team_id),
    INDEX idx_user (user_id),
    INDEX idx_role (role),
    INDEX idx_last_active (last_active_at)
);

-- ç¾¤ç»„åŠ å…¥ç”³è¯·è¡¨
CREATE TABLE team_join_requests (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    team_id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    email VARCHAR(255) NOT NULL,
    requested_role ENUM('member') DEFAULT 'member',
    message TEXT, -- ç”³è¯·ç†ç”±
    status ENUM('pending', 'approved', 'rejected', 'expired') DEFAULT 'pending',
    expires_at TIMESTAMP NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    resolved_at TIMESTAMP NULL,
    resolved_by VARCHAR(36) NULL,
    rejection_reason TEXT,
    
    UNIQUE(team_id, user_id),
    INDEX idx_team (team_id),
    INDEX idx_user (user_id),
    INDEX idx_status (status),
    INDEX idx_expires (expires_at)
);

-- ç¾¤ç»„é‚€è¯·è¡¨
CREATE TABLE team_invitations (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    team_id VARCHAR(36) NOT NULL,
    invitee_email VARCHAR(255) NOT NULL,
    invitee_user_id VARCHAR(36) NULL,
    invited_role ENUM('admin', 'member') DEFAULT 'member',
    invitation_token VARCHAR(255) UNIQUE NOT NULL,
    invited_by VARCHAR(36) NOT NULL,
    expires_at TIMESTAMP NOT NULL,
    status ENUM('pending', 'accepted', 'declined', 'expired') DEFAULT 'pending',
    message TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    accepted_at TIMESTAMP NULL,
    
    INDEX idx_team (team_id),
    INDEX idx_email (invitee_email),
    INDEX idx_user (invitee_user_id),
    INDEX idx_status (status),
    INDEX idx_token (invitation_token),
    INDEX idx_expires (expires_at)
);

-- ç¾¤ç»„æ´»åŠ¨è®°å½•è¡¨
CREATE TABLE team_activities (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    team_id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    activity_type VARCHAR(100) NOT NULL,
    description TEXT NOT NULL,
    metadata JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_team (team_id),
    INDEX idx_user (user_id),
    INDEX idx_type (activity_type),
    INDEX idx_created (created_at)
);
```

### æ¥å£è®¾è®¡
```yaml
# ç¾¤ç»„ç®¡ç†
GET /teams                         # è·å–ç¾¤ç»„åˆ—è¡¨
POST /teams                        # åˆ›å»ºç¾¤ç»„
GET /teams/{team_id}               # è·å–ç¾¤ç»„è¯¦æƒ…
PUT /teams/{team_id}               # æ›´æ–°ç¾¤ç»„ä¿¡æ¯ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰
DELETE /teams/{team_id}            # åˆ é™¤ç¾¤ç»„ï¼ˆä»…ç¾¤ä¸»ï¼‰
POST /teams/{team_id}/transfer     # è½¬è®©ç¾¤ç»„æ‰€æœ‰æƒï¼ˆä»…ç¾¤ä¸»ï¼‰

# ç¾¤ç»„æˆå‘˜ç®¡ç†
GET /teams/{team_id}/members       # è·å–æˆå‘˜åˆ—è¡¨
POST /teams/{team_id}/members/{user_id}/promote # æå‡æˆå‘˜ä¸ºç®¡ç†å‘˜ï¼ˆä»…ç¾¤ä¸»ï¼‰
POST /teams/{team_id}/members/{user_id}/demote  # é™çº§ç®¡ç†å‘˜ä¸ºæˆå‘˜ï¼ˆä»…ç¾¤ä¸»ï¼‰
DELETE /teams/{team_id}/members/{user_id}       # ç§»é™¤æˆå‘˜ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰

# é‚€è¯·ç®¡ç†
POST /teams/{team_id}/invitations  # å‘é€é‚€è¯·ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰
GET /teams/{team_id}/invitations   # è·å–é‚€è¯·åˆ—è¡¨ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰
PUT /invitations/{invitation_id}/accept # æ¥å—é‚€è¯·
PUT /invitations/{invitation_id}/decline # æ‹’ç»é‚€è¯·
DELETE /invitations/{invitation_id} # å–æ¶ˆé‚€è¯·ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰

# ç¾¤ç»„åŠ å…¥ç”³è¯·
POST /teams/{team_id}/join-requests   # ç”³è¯·åŠ å…¥ç¾¤ç»„
GET /teams/{team_id}/join-requests    # è·å–åŠ å…¥ç”³è¯·åˆ—è¡¨ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰
PUT /join-requests/{request_id}/approve # æ‰¹å‡†ç”³è¯·ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰
PUT /join-requests/{request_id}/reject  # æ‹’ç»ç”³è¯·ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰

# æƒé™æ£€æŸ¥
GET /teams/{team_id}/my-role       # è·å–å½“å‰ç”¨æˆ·åœ¨ç¾¤ç»„ä¸­çš„è§’è‰²
POST /teams/{team_id}/check-permission # æ£€æŸ¥ç‰¹å®šæƒé™

# æ´»åŠ¨è®°å½•
GET /teams/{team_id}/activities # è·å–æ´»åŠ¨è®°å½•

# ç»Ÿè®¡ä¿¡æ¯
GET /teams/{team_id}/statistics # è·å–ç¾¤ç»„ç»Ÿè®¡ä¿¡æ¯

# å†…éƒ¨æ¥å£
GET /internal/teams/{team_id}/member/{user_id}/role # è·å–ç”¨æˆ·åœ¨ç¾¤ç»„ä¸­çš„è§’è‰²
GET /internal/teams/user/{user_id}/roles # è·å–ç”¨æˆ·åœ¨æ‰€æœ‰ç¾¤ç»„ä¸­çš„è§’è‰²
POST /internal/teams/notify-role-change # é€šçŸ¥è§’è‰²å˜æ›´
```

### 5. é¡¹ç›®æœåŠ¡ (project-service)

**èŒè´£**: é¡¹ç›®ç®¡ç†ã€é¡¹ç›®ç»´æŠ¤å‘˜ç®¡ç†ã€é¡¹ç›®è®¿é—®æ§åˆ¶

### æ•°æ®åº“è®¾è®¡ (MySQL)
```sql
-- é¡¹ç›®è¡¨
CREATE TABLE projects (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    team_id VARCHAR(36) NOT NULL,
    visibility ENUM('public', 'private') NOT NULL DEFAULT 'private',
    status ENUM('active', 'archived', 'deleted') DEFAULT 'active',
    template_id VARCHAR(36) NULL,
    settings JSON, -- é¡¹ç›®é…ç½®
    allow_member_edit BOOLEAN DEFAULT FALSE, -- æ˜¯å¦å…è®¸æ™®é€šç¾¤ç»„æˆå‘˜ç¼–è¾‘
    allow_external_view BOOLEAN DEFAULT FALSE, -- æ˜¯å¦å…è®¸å¤–éƒ¨ç”¨æˆ·æŸ¥çœ‹ï¼ˆä»…publicé¡¹ç›®æœ‰æ•ˆï¼‰
    allow_external_comment BOOLEAN DEFAULT FALSE, -- æ˜¯å¦å…è®¸å¤–éƒ¨ç”¨æˆ·è¯„è®º
    created_by VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_team (team_id),
    INDEX idx_creator (created_by),
    INDEX idx_visibility (visibility),
    INDEX idx_status (status),
    INDEX idx_template (template_id),
    FULLTEXT INDEX ft_name_desc (name, description)
);

-- é¡¹ç›®ç»´æŠ¤å‘˜è¡¨
CREATE TABLE project_maintainers (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    project_id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    assigned_by VARCHAR(36) NOT NULL, -- åˆ†é…è€…ï¼ˆç¾¤ä¸»æˆ–ç¾¤ç»„ç®¡ç†å‘˜ï¼‰
    assigned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE(project_id, user_id),
    INDEX idx_project (project_id),
    INDEX idx_user (user_id),
    INDEX idx_assigned_by (assigned_by)
);

-- é¡¹ç›®æ¨¡æ¿è¡¨
CREATE TABLE project_templates (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    template_data JSON,
    category VARCHAR(100),
    is_public BOOLEAN DEFAULT FALSE,
    usage_count INT DEFAULT 0,
    created_by VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_category (category),
    INDEX idx_public (is_public),
    INDEX idx_usage (usage_count DESC)
);

-- æ ‡ç­¾è¡¨
CREATE TABLE tags (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    name VARCHAR(255) NOT NULL,
    color VARCHAR(7) DEFAULT '#6B7280',
    category VARCHAR(100),
    description TEXT,
    usage_count INT DEFAULT 0,
    created_by VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE(name, category),
    INDEX idx_category (category),
    INDEX idx_usage (usage_count DESC),
    INDEX idx_name (name)
);

-- é¡¹ç›®æ ‡ç­¾å…³è”è¡¨
CREATE TABLE project_tags (
    project_id VARCHAR(36) NOT NULL,
    tag_id VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    PRIMARY KEY (project_id, tag_id),
    INDEX idx_tag (tag_id)
);

-- é¡¹ç›®æ´»åŠ¨è®°å½•è¡¨
CREATE TABLE project_activities (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    project_id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    activity_type VARCHAR(100) NOT NULL,
    description TEXT NOT NULL,
    metadata JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_project (project_id),
    INDEX idx_user (user_id),
    INDEX idx_type (activity_type),
    INDEX idx_created (created_at)
);

-- é¡¹ç›®è®¿é—®ç”³è¯·è¡¨
CREATE TABLE project_access_requests (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    project_id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    access_type ENUM('view', 'maintainer') DEFAULT 'view',
    message TEXT,
    status ENUM('pending', 'approved', 'rejected', 'expired') DEFAULT 'pending',
    expires_at TIMESTAMP NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    resolved_at TIMESTAMP NULL,
    resolved_by VARCHAR(36) NULL,
    rejection_reason TEXT,
    
    UNIQUE(project_id, user_id),
    INDEX idx_project (project_id),
    INDEX idx_user (user_id),
    INDEX idx_status (status),
    INDEX idx_expires (expires_at)
);

-- é¡¹ç›®å¤–éƒ¨è®¿é—®è®°å½•è¡¨
CREATE TABLE project_external_access (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    project_id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36) NULL,
    access_token VARCHAR(255),
    ip_address VARCHAR(45),
    user_agent TEXT,
    accessed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    access_duration INT,
    
    INDEX idx_project (project_id),
    INDEX idx_user (user_id),
    INDEX idx_token (access_token),
    INDEX idx_accessed_at (accessed_at)
);
```

### æ¥å£è®¾è®¡
```yaml
# é¡¹ç›®ç®¡ç†
GET /projects                  # è·å–å¯è®¿é—®çš„é¡¹ç›®åˆ—è¡¨
POST /teams/{team_id}/projects # åˆ›å»ºé¡¹ç›®ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰
POST /projects/from-template/{template_id} # ä»æ¨¡æ¿åˆ›å»ºé¡¹ç›®
GET /projects/{project_id}     # è·å–é¡¹ç›®è¯¦æƒ…
PUT /projects/{project_id}     # æ›´æ–°é¡¹ç›®ä¿¡æ¯ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜/ç»´æŠ¤å‘˜ï¼‰
POST /projects/{project_id}/archive # å½’æ¡£é¡¹ç›®ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰
DELETE /projects/{project_id}  # åˆ é™¤é¡¹ç›®ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰

# é¡¹ç›®æ¨¡æ¿
GET /project-templates         # è·å–é¡¹ç›®æ¨¡æ¿åˆ—è¡¨
POST /project-templates        # åˆ›å»ºé¡¹ç›®æ¨¡æ¿
GET /project-templates/{template_id} # è·å–æ¨¡æ¿è¯¦æƒ…
PUT /project-templates/{template_id} # æ›´æ–°æ¨¡æ¿
DELETE /project-templates/{template_id} # åˆ é™¤æ¨¡æ¿

# æ ‡ç­¾ç®¡ç†
GET /tags                      # è·å–æ ‡ç­¾åˆ—è¡¨
POST /tags                     # åˆ›å»ºæ ‡ç­¾
PUT /tags/{tag_id}            # æ›´æ–°æ ‡ç­¾
DELETE /tags/{tag_id}         # åˆ é™¤æ ‡ç­¾
POST /projects/{project_id}/tags # ä¸ºé¡¹ç›®æ·»åŠ æ ‡ç­¾
DELETE /projects/{project_id}/tags/{tag_id} # ç§»é™¤é¡¹ç›®æ ‡ç­¾

# é¡¹ç›®è®¿é—®æ§åˆ¶
GET /projects/discover               # å‘ç°å…¬å¼€é¡¹ç›®
GET /projects/accessible             # è·å–ç”¨æˆ·å¯è®¿é—®çš„é¡¹ç›®åˆ—è¡¨
GET /projects/{project_id}/permissions # è·å–é¡¹ç›®æƒé™è®¾ç½®
PUT /projects/{project_id}/permissions # æ›´æ–°é¡¹ç›®æƒé™è®¾ç½®ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰

# é¡¹ç›®ç»´æŠ¤å‘˜ç®¡ç†
GET /projects/{project_id}/maintainers  # è·å–ç»´æŠ¤å‘˜åˆ—è¡¨
POST /projects/{project_id}/maintainers # æŒ‡å®šç»´æŠ¤å‘˜ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰
DELETE /projects/{project_id}/maintainers/{user_id} # ç§»é™¤ç»´æŠ¤å‘˜ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰

# é¡¹ç›®è®¿é—®ç”³è¯·
POST /projects/{project_id}/access-requests # ç”³è¯·é¡¹ç›®è®¿é—®æƒé™
GET /projects/{project_id}/access-requests  # è·å–è®¿é—®ç”³è¯·åˆ—è¡¨ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰
PUT /access-requests/{request_id}/approve   # æ‰¹å‡†è®¿é—®ç”³è¯·ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰
PUT /access-requests/{request_id}/reject    # æ‹’ç»è®¿é—®ç”³è¯·ï¼ˆç¾¤ä¸»/ç®¡ç†å‘˜ï¼‰

# å¤–éƒ¨è®¿é—®
POST /projects/{project_id}/external-access-token # ç”Ÿæˆå¤–éƒ¨è®¿é—®ä»¤ç‰Œ
GET /projects/external/{access_token}       # é€šè¿‡ä»¤ç‰Œè®¿é—®é¡¹ç›®

# æ´»åŠ¨è®°å½•
GET /projects/{project_id}/activities # è·å–é¡¹ç›®æ´»åŠ¨è®°å½•

# ç»Ÿè®¡ä¿¡æ¯
GET /projects/{project_id}/statistics # è·å–é¡¹ç›®ç»Ÿè®¡ä¿¡æ¯

# å†…éƒ¨æ¥å£
GET /internal/projects/{project_id}/maintainers # è·å–é¡¹ç›®ç»´æŠ¤å‘˜åˆ—è¡¨
GET /internal/projects/user/{user_id}/maintainer-projects # è·å–ç”¨æˆ·ç»´æŠ¤çš„é¡¹ç›®åˆ—è¡¨
POST /internal/projects/notify-maintainer-change # é€šçŸ¥ç»´æŠ¤å‘˜å˜æ›´
GET /internal/projects/{project_id}/team # è·å–é¡¹ç›®æ‰€å±ç¾¤ç»„
```

### 6. æ¶æ„è®¾è®¡æœåŠ¡ (architecture-service)
**èŒè´£**: å­˜å‚¨å’Œç®¡ç†ç³»ç»Ÿæ¶æ„å›¾ã€æ”¯æŒå¤šç§å›¾è¡¨ç±»å‹ã€æ¶æ„éªŒè¯åˆ†æ

#### æ•°æ®åº“è®¾è®¡ (MongoDB)
```javascript
// diagramsé›†åˆ
{
  _id: ObjectId,
  project_id: String,
  name: String,
  description: String,
  type: String, // "system_architecture", "deployment", "network", "data_flow", "component"
  data: {
    nodes: Array, // èŠ‚ç‚¹æ•°æ®
    edges: Array, // è¿æ¥æ•°æ®
    layout: Object, // å¸ƒå±€ä¿¡æ¯
    styles: Object // æ ·å¼é…ç½®
  },
  metadata: {
    version: Number,
    created_by: String,
    last_modified_by: String,
    created_at: Date,
    updated_at: Date,
    tags: [String],
    complexity_score: Number,
    validation_status: String // "valid", "warning", "error"
  },
  collaboration: {
    locked_by: String,
    locked_at: Date,
    active_editors: [String]
  },
  sharing: {
    is_public: Boolean,
    share_token: String,
    allowed_users: [String]
  },
  validation_rules: {
    custom_rules: [Object],
    compliance_checks: [String],
    architectural_patterns: [String]
  }
}

// diagram_versionsé›†åˆ
{
  _id: ObjectId,
  diagram_id: ObjectId,
  version: Number,
  data: Object,
  changes: Object,
  created_by: String,
  created_at: Date,
  comment: String,
  parent_version: Number,
  is_major: Boolean
}

// diagram_commentsé›†åˆ
{
  _id: ObjectId,
  diagram_id: ObjectId,
  user_id: String,
  content: String,
  position: Object,
  status: String, // "open", "resolved"
  replies: [
    {
      user_id: String,
      content: String,
      created_at: Date
    }
  ],
  created_at: Date,
  resolved_by: String,
  resolved_at: Date
}
```

#### æ¥å£è®¾è®¡
```yaml
# æ¶æ„å›¾ç®¡ç†
GET /projects/{project_id}/diagrams # è·å–æ¶æ„å›¾åˆ—è¡¨
POST /projects/{project_id}/diagrams # åˆ›å»ºæ¶æ„å›¾
GET /diagrams/{diagram_id}         # è·å–æ¶æ„å›¾è¯¦æƒ…
PUT /diagrams/{diagram_id}         # æ›´æ–°æ¶æ„å›¾
DELETE /diagrams/{diagram_id}      # åˆ é™¤æ¶æ„å›¾
POST /diagrams/{diagram_id}/duplicate # å¤åˆ¶æ¶æ„å›¾

# ç‰ˆæœ¬ç®¡ç†
GET /diagrams/{diagram_id}/versions # è·å–ç‰ˆæœ¬å†å²
POST /diagrams/{diagram_id}/versions # åˆ›å»ºæ–°ç‰ˆæœ¬
GET /diagrams/{diagram_id}/versions/{version} # è·å–ç‰¹å®šç‰ˆæœ¬
POST /diagrams/{diagram_id}/restore/{version} # æ¢å¤åˆ°æŒ‡å®šç‰ˆæœ¬

# éªŒè¯å’Œåˆ†æ
POST /diagrams/{diagram_id}/validate # éªŒè¯æ¶æ„å›¾
POST /diagrams/{diagram_id}/analyze  # åˆ†ææ¶æ„å¤æ‚åº¦
GET /diagrams/{diagram_id}/suggestions # è·å–ä¼˜åŒ–å»ºè®®
POST /diagrams/{diagram_id}/compliance-check # åˆè§„æ£€æŸ¥

# è¯„è®ºç³»ç»Ÿ
GET /diagrams/{diagram_id}/comments  # è·å–è¯„è®ºåˆ—è¡¨
POST /diagrams/{diagram_id}/comments # æ·»åŠ è¯„è®º
PUT /comments/{comment_id}           # æ›´æ–°è¯„è®º
DELETE /comments/{comment_id}        # åˆ é™¤è¯„è®º
POST /comments/{comment_id}/resolve  # è§£å†³è¯„è®º

# å¯¼å‡ºåŠŸèƒ½
POST /diagrams/{diagram_id}/export   # å¯¼å‡ºæ¶æ„å›¾
GET /diagrams/{diagram_id}/export/{format} # ä¸‹è½½å¯¼å‡ºæ–‡ä»¶
```

### 7. æµç¨‹å›¾è®¾è®¡æœåŠ¡ (flow-diagram-service)
**èŒè´£**: ä¸šåŠ¡æµç¨‹å›¾ã€ç³»ç»Ÿæµç¨‹å›¾è®¾è®¡ä¸ç®¡ç†ã€æµç¨‹æ¨¡æ‹Ÿåˆ†æ

#### æ•°æ®åº“è®¾è®¡ (MongoDB)
```javascript
// flow_diagramsé›†åˆ
{
  _id: ObjectId,
  project_id: String,
  name: String,
  description: String,
  type: String, // "business_process", "system_flow", "user_journey", "workflow", "decision_tree"
  flow_data: {
    nodes: [
      {
        id: String,
        type: String, // "start", "process", "decision", "end", "parallel", "timer", "gateway"
        position: {x: Number, y: Number},
        data: {
          label: String,
          description: String,
          conditions: Array,
          duration: Number,
          responsible: String,
          properties: Object
        }
      }
    ],
    edges: [
      {
        id: String,
        source: String,
        target: String,
        label: String,
        conditions: Object,
        probability: Number
      }
    ]
  },
  validation_rules: {
    required_nodes: [String],
    forbidden_loops: Boolean,
    max_complexity: Number,
    custom_rules: [Object]
  },
  simulation_results: {
    avg_execution_time: Number,
    bottlenecks: [String],
    optimization_suggestions: [String],
    performance_metrics: Object
  },
  created_by: String,
  created_at: Date,
  updated_at: Date,
  sharing: {
    is_public: Boolean,
    share_token: String
  }
}

// flow_simulation_historyé›†åˆ
{
  _id: ObjectId,
  flow_diagram_id: ObjectId,
  simulation_config: Object,
  results: Object,
  created_by: String,
  created_at: Date
}
```

#### æ¥å£è®¾è®¡
```yaml
# æµç¨‹å›¾ç®¡ç†
GET /projects/{project_id}/flow-diagrams # è·å–æµç¨‹å›¾åˆ—è¡¨
POST /projects/{project_id}/flow-diagrams # åˆ›å»ºæµç¨‹å›¾
GET /flow-diagrams/{diagram_id}        # è·å–æµç¨‹å›¾è¯¦æƒ…
PUT /flow-diagrams/{diagram_id}        # æ›´æ–°æµç¨‹å›¾
DELETE /flow-diagrams/{diagram_id}     # åˆ é™¤æµç¨‹å›¾
POST /flow-diagrams/{diagram_id}/duplicate # å¤åˆ¶æµç¨‹å›¾

# éªŒè¯å’Œæ¨¡æ‹Ÿ
POST /flow-diagrams/{diagram_id}/validate # éªŒè¯æµç¨‹å›¾
POST /flow-diagrams/{diagram_id}/simulate # æµç¨‹æ¨¡æ‹Ÿ
GET /flow-diagrams/{diagram_id}/analysis  # è·å–æµç¨‹åˆ†ææŠ¥å‘Š
GET /flow-diagrams/{diagram_id}/simulation-history # è·å–æ¨¡æ‹Ÿå†å²

# ä¼˜åŒ–å»ºè®®
POST /flow-diagrams/{diagram_id}/optimize # è·å–ä¼˜åŒ–å»ºè®®
POST /flow-diagrams/{diagram_id}/bottleneck-analysis # ç“¶é¢ˆåˆ†æ

# å¯¼å‡ºå’Œåˆ†äº«
POST /flow-diagrams/{diagram_id}/export # å¯¼å‡ºæµç¨‹å›¾
POST /flow-diagrams/{diagram_id}/share  # ç”Ÿæˆåˆ†äº«é“¾æ¥
```

### 8. APIè®¾è®¡æœåŠ¡ (api-design-service)
**èŒè´£**: APIè®¾è®¡ä¸ç®¡ç†ï¼ŒåŸºäºOpenAPIè§„èŒƒï¼Œæ”¯æŒå¤šç§APIç±»å‹ã€MockæœåŠ¡ã€æµ‹è¯•ç®¡ç†

#### æ•°æ®åº“è®¾è®¡ (MongoDB)
```javascript
// api_specsé›†åˆ
{
  _id: ObjectId,
  project_id: String,
  name: String,
  description: String,
  type: String, // "rest", "graphql", "grpc", "websocket"
  spec: Object, // OpenAPI/GraphQL/gRPCè§„èŒƒ
  version: String,
  status: String, // "draft", "review", "published", "deprecated"
  environments: [
    {
      name: String, // "dev", "staging", "prod"
      base_url: String,
      headers: Object,
      auth_config: Object,
      variables: Object
    }
  ],
  testing: {
    test_cases: Array,
    coverage_report: Object,
    performance_metrics: Object,
    last_test_run: Date
  },
  documentation: {
    examples: Array,
    guides: Array,
    changelogs: Array,
    auto_generated: Boolean
  },
  collaboration: {
    reviewers: [String],
    approval_status: String,
    comments: [Object]
  },
  created_by: String,
  created_at: Date,
  updated_at: Date
}

// api_mocksé›†åˆ
{
  _id: ObjectId,
  api_spec_id: ObjectId,
  endpoint_path: String,
  method: String,
  mock_data: Object,
  rules: Object,
  response_scenarios: [
    {
      name: String,
      condition: Object,
      response: Object,
      delay_ms: Number
    }
  ],
  is_active: Boolean,
  created_by: String,
  created_at: Date
}

// api_usage_analyticsé›†åˆ
{
  _id: ObjectId,
  api_spec_id: ObjectId,
  endpoint: String,
  method: String,
  usage_stats: {
    total_calls: Number,
    error_rate: Number,
    avg_response_time: Number,
    last_called: Date
  },
  date: Date
}
```

#### æ¥å£è®¾è®¡
```yaml
# APIè§„èŒƒç®¡ç†
GET /projects/{project_id}/api-specs    # è·å–APIè§„èŒƒåˆ—è¡¨
POST /projects/{project_id}/api-specs   # åˆ›å»ºAPIè§„èŒƒ
GET /api-specs/{spec_id}                # è·å–APIè§„èŒƒè¯¦æƒ…
PUT /api-specs/{spec_id}                # æ›´æ–°APIè§„èŒƒ
DELETE /api-specs/{spec_id}             # åˆ é™¤APIè§„èŒƒ
POST /api-specs/{spec_id}/duplicate     # å¤åˆ¶APIè§„èŒƒ

# ç‰ˆæœ¬ç®¡ç†
GET /api-specs/{spec_id}/versions       # è·å–ç‰ˆæœ¬åˆ—è¡¨
POST /api-specs/{spec_id}/versions      # åˆ›å»ºæ–°ç‰ˆæœ¬
POST /api-specs/{spec_id}/publish       # å‘å¸ƒç‰ˆæœ¬
POST /api-specs/{spec_id}/deprecate     # åºŸå¼ƒç‰ˆæœ¬

# éªŒè¯å’Œæµ‹è¯•
POST /api-specs/{spec_id}/validate      # éªŒè¯APIè§„èŒƒ
POST /api-specs/{spec_id}/test          # æµ‹è¯•APIç«¯ç‚¹
GET /api-specs/{spec_id}/test-results   # è·å–æµ‹è¯•ç»“æœ
POST /api-specs/{spec_id}/test-suite    # åˆ›å»ºæµ‹è¯•å¥—ä»¶

# æ–‡æ¡£ç”Ÿæˆ
POST /api-specs/{spec_id}/generate-docs # ç”Ÿæˆæ–‡æ¡£
GET /api-specs/{spec_id}/docs           # è·å–APIæ–‡æ¡£
POST /api-specs/{spec_id}/export-docs   # å¯¼å‡ºæ–‡æ¡£

# MockæœåŠ¡
GET /api-specs/{spec_id}/mocks          # è·å–Mockåˆ—è¡¨
POST /api-specs/{spec_id}/mocks         # åˆ›å»ºMockæ•°æ®
PUT /mocks/{mock_id}                    # æ›´æ–°Mockæ•°æ®
DELETE /mocks/{mock_id}                 # åˆ é™¤Mockæ•°æ®
POST /mocks/{mock_id}/activate          # æ¿€æ´»Mock

# ä»£ç ç”Ÿæˆ
POST /api-specs/{spec_id}/generate-client # ç”Ÿæˆå®¢æˆ·ç«¯ä»£ç 
POST /api-specs/{spec_id}/generate-server # ç”ŸæˆæœåŠ¡ç«¯ä»£ç 
GET /api-specs/{spec_id}/code-templates   # è·å–ä»£ç æ¨¡æ¿

# åˆ†æç»Ÿè®¡
GET /api-specs/{spec_id}/analytics      # è·å–ä½¿ç”¨åˆ†æ
GET /api-specs/{spec_id}/performance    # è·å–æ€§èƒ½åˆ†æ
```

### 9. æ•°æ®åº“è®¾è®¡æœåŠ¡ (db-design-service)
**èŒè´£**: æ•°æ®åº“æ¨¡å‹è®¾è®¡ä¸ç®¡ç†ï¼Œæ”¯æŒå¤šç§æ•°æ®åº“ç±»å‹ï¼ŒERDç”Ÿæˆï¼Œè¿ç§»è„šæœ¬ç”Ÿæˆ

#### æ•°æ®åº“è®¾è®¡ (MongoDB)
```javascript
// database_designsé›†åˆ
{
  _id: ObjectId,
  project_id: String,
  name: String,
  description: String,
  db_type: String, // "mysql", "postgresql", "mongodb", "redis", "oracle"
  version: String,
  schemas: [
    {
      name: String,
      tables: [
        {
          name: String,
          comment: String,
          columns: [
            {
              name: String,
              type: String,
              length: Number,
              precision: Number,
              scale: Number,
              nullable: Boolean,
              default_value: String,
              auto_increment: Boolean,
              primary_key: Boolean,
              unique: Boolean,
              comment: String,
              foreign_key: {
                table: String,
                column: String,
                on_delete: String,
                on_update: String
              }
            }
          ],
          indexes: [
            {
              name: String,
              type: String, // "btree", "hash", "fulltext"
              columns: [String],
              unique: Boolean,
              comment: String
            }
          ],
          triggers: [
            {
              name: String,
              event: String, // "insert", "update", "delete"
              timing: String, // "before", "after"
              definition: String
            }
          ],
          partitioning: {
            type: String, // "range", "hash", "list"
            column: String,
            partitions: Array
          }
        }
      ],
      views: [
        {
          name: String,
          definition: String,
          comment: String,
          dependencies: [String]
        }
      ],
      procedures: [
        {
          name: String,
          parameters: Array,
          definition: String,
          comment: String
        }
      ],
      functions: [
        {
          name: String,
          parameters: Array,
          return_type: String,
          definition: String,
          comment: String
        }
      ]
    }
  ],
  relationships: [
    {
      from_table: String,
      from_column: String,
      to_table: String,
      to_column: String,
      type: String,
      cardinality: String,
      description: String
    }
  ],
  optimization: {
    performance_analysis: Object,
    index_suggestions: Array,
    normalization_level: String,
    query_optimization: Array
  },
  data_dictionary: {
    business_terms: Object,
    data_lineage: Object,
    privacy_classifications: Object
  },
  created_by: String,
  created_at: Date,
  updated_at: Date
}

// db_migrationsé›†åˆ
{
  _id: ObjectId,
  design_id: ObjectId,
  version_from: String,
  version_to: String,
  migration_script: String,
  rollback_script: String,
  applied: Boolean,
  applied_at: Date,
  created_by: String,
  created_at: Date
}
```

#### æ¥å£è®¾è®¡
```yaml
# æ•°æ®åº“è®¾è®¡ç®¡ç†
GET /projects/{project_id}/db-designs   # è·å–æ•°æ®åº“è®¾è®¡åˆ—è¡¨
POST /projects/{project_id}/db-designs  # åˆ›å»ºæ•°æ®åº“è®¾è®¡
GET /db-designs/{design_id}             # è·å–æ•°æ®åº“è®¾è®¡è¯¦æƒ…
PUT /db-designs/{design_id}             # æ›´æ–°æ•°æ®åº“è®¾è®¡
DELETE /db-designs/{design_id}          # åˆ é™¤æ•°æ®åº“è®¾è®¡
POST /db-designs/{design_id}/duplicate  # å¤åˆ¶æ•°æ®åº“è®¾è®¡

# ERDç®¡ç†
GET /db-designs/{design_id}/erd         # è·å–ERDå›¾
POST /db-designs/{design_id}/erd/generate # ç”ŸæˆERDå›¾
PUT /db-designs/{design_id}/erd         # æ›´æ–°ERDå›¾

# éªŒè¯å’Œä¼˜åŒ–
POST /db-designs/{design_id}/validate   # éªŒè¯è®¾è®¡
POST /db-designs/{design_id}/optimize   # è·å–ä¼˜åŒ–å»ºè®®
POST /db-designs/{design_id}/analyze    # æ€§èƒ½åˆ†æ
POST /db-designs/{design_id}/normalize  # è§„èŒƒåŒ–åˆ†æ

# ä»£ç ç”Ÿæˆ
POST /db-designs/{design_id}/generate-sql # ç”ŸæˆSQLè„šæœ¬
POST /db-designs/{design_id}/generate-migration # ç”Ÿæˆè¿ç§»è„šæœ¬
POST /db-designs/{design_id}/generate-docs # ç”Ÿæˆæ•°æ®åº“æ–‡æ¡£
POST /db-designs/{design_id}/generate-models # ç”ŸæˆORMæ¨¡å‹

# é€†å‘å·¥ç¨‹
POST /db-designs/reverse-engineer       # ä»ç°æœ‰æ•°æ®åº“é€†å‘ç”Ÿæˆè®¾è®¡
POST /db-designs/import-sql             # ä»SQLè„šæœ¬å¯¼å…¥è®¾è®¡

# æ¯”è¾ƒå’ŒåŒæ­¥
POST /db-designs/{design_id}/compare    # æ¯”è¾ƒä¸åŒç‰ˆæœ¬
POST /db-designs/{design_id}/sync       # åŒæ­¥åˆ°ç›®æ ‡æ•°æ®åº“
GET /db-designs/{design_id}/diff/{target_version} # è·å–ç‰ˆæœ¬å·®å¼‚
```

### 10. åŠŸèƒ½å¯¼å›¾æœåŠ¡ (feature-map-service)
**èŒè´£**: åŠŸèƒ½éœ€æ±‚æ¢³ç†ã€æ€ç»´å¯¼å›¾ç®¡ç†ã€é¡¹ç›®è§„åˆ’ã€éœ€æ±‚è¿½è¸ª

#### æ•°æ®åº“è®¾è®¡ (MongoDB)
```javascript
// feature_mapsé›†åˆ
{
  _id: ObjectId,
  project_id: String,
  name: String,
  description: String,
  type: String, // "feature_breakdown", "requirement_analysis", "task_planning", "roadmap"
  mind_map: {
    root: {
      id: String,
      title: String,
      description: String,
      children: [
        {
          id: String,
          title: String,
          description: String,
          type: String, // "epic", "feature", "story", "task", "bug"
          status: String, // "planned", "in_progress", "completed", "blocked", "cancelled"
          priority: String, // "high", "medium", "low", "critical"
          complexity: Number, // 1-10
          assignee: String,
          estimated_hours: Number,
          actual_hours: Number,
          tags: [String],
          acceptance_criteria: [String],
          dependencies: [String],
          attachments: [String],
          comments: [Object],
          due_date: Date,
          start_date: Date,
          progress: Number,
          children: Array
        }
      ]
    }
  },
  metrics: {
    total_features: Number,
    completed_features: Number,
    total_estimated_hours: Number,
    total_actual_hours: Number,
    progress_percentage: Number,
    velocity: Number
  },
  integration: {
    jira_project_key: String,
    github_repo: String,
    sync_enabled: Boolean,
    last_sync: Date
  },
  created_by: String,
  created_at: Date,
  updated_at: Date
}

// feature_dependenciesé›†åˆ
{
  _id: ObjectId,
  feature_map_id: ObjectId,
  source_feature_id: String,
  target_feature_id: String,
  dependency_type: String, // "blocks", "requires", "related"
  description: String,
  created_at: Date
}

// feature_historyé›†åˆ
{
  _id: ObjectId,
  feature_map_id: ObjectId,
  feature_id: String,
  action: String, // "created", "updated", "moved", "deleted", "status_changed"
  changes: Object,
  user_id: String,
  timestamp: Date
}
```

#### æ¥å£è®¾è®¡
```yaml
# åŠŸèƒ½å¯¼å›¾ç®¡ç†
GET /projects/{project_id}/feature-maps # è·å–åŠŸèƒ½å¯¼å›¾åˆ—è¡¨
POST /projects/{project_id}/feature-maps # åˆ›å»ºåŠŸèƒ½å¯¼å›¾
GET /feature-maps/{map_id}              # è·å–åŠŸèƒ½å¯¼å›¾è¯¦æƒ…
PUT /feature-maps/{map_id}              # æ›´æ–°åŠŸèƒ½å¯¼å›¾
DELETE /feature-maps/{map_id}           # åˆ é™¤åŠŸèƒ½å¯¼å›¾
POST /feature-maps/{map_id}/duplicate   # å¤åˆ¶åŠŸèƒ½å¯¼å›¾

# èŠ‚ç‚¹æ“ä½œ
POST /feature-maps/{map_id}/nodes       # æ·»åŠ èŠ‚ç‚¹
PUT /feature-maps/{map_id}/nodes/{node_id} # æ›´æ–°èŠ‚ç‚¹
DELETE /feature-maps/{map_id}/nodes/{node_id} # åˆ é™¤èŠ‚ç‚¹
POST /feature-maps/{map_id}/nodes/{node_id}/move # ç§»åŠ¨èŠ‚ç‚¹
POST /feature-maps/{map_id}/nodes/{node_id}/assign # åˆ†é…è´Ÿè´£äºº

# ä¾èµ–ç®¡ç†
GET /feature-maps/{map_id}/dependencies # è·å–ä¾èµ–å…³ç³»
POST /feature-maps/{map_id}/dependencies # åˆ›å»ºä¾èµ–å…³ç³»
DELETE /dependencies/{dependency_id}     # åˆ é™¤ä¾èµ–å…³ç³»
GET /feature-maps/{map_id}/dependency-graph # è·å–ä¾èµ–å›¾

# ç»Ÿè®¡å’ŒæŠ¥å‘Š
GET /feature-maps/{map_id}/metrics      # è·å–é¡¹ç›®æŒ‡æ ‡
GET /feature-maps/{map_id}/progress     # è·å–è¿›åº¦æŠ¥å‘Š
GET /feature-maps/{map_id}/velocity     # è·å–å¼€å‘é€Ÿåº¦
GET /feature-maps/{map_id}/burndown     # è·å–ç‡ƒå°½å›¾æ•°æ®

# å¯¼å‡ºåŠŸèƒ½
POST /feature-maps/{map_id}/export      # å¯¼å‡ºä¸ºå…¶ä»–æ ¼å¼
POST /feature-maps/{map_id}/export/gantt # å¯¼å‡ºç”˜ç‰¹å›¾
POST /feature-maps/{map_id}/export/roadmap # å¯¼å‡ºäº§å“è·¯çº¿å›¾

# é›†æˆåŠŸèƒ½
POST /feature-maps/{map_id}/sync-jira   # åŒæ­¥åˆ°Jira
POST /feature-maps/{map_id}/sync-github # åŒæ­¥åˆ°GitHub
GET /feature-maps/{map_id}/sync-status  # è·å–åŒæ­¥çŠ¶æ€
```

### 11. å®æ—¶åä½œæœåŠ¡ (collaboration-service)
**èŒè´£**: å®æ—¶åä½œç¼–è¾‘ã€å†²çªè§£å†³ã€åœ¨çº¿çŠ¶æ€ç®¡ç†ã€æ“ä½œåŒæ­¥

#### æ•°æ®åº“è®¾è®¡ (MySQL + Redis)
```sql
-- åä½œä¼šè¯è¡¨
CREATE TABLE collaboration_sessions (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    document_id VARCHAR(36) NOT NULL,
    document_type ENUM('diagram', 'api_spec', 'db_design', 'flow', 'mind_map') NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    session_token VARCHAR(255) NOT NULL,
    cursor_position JSON,
    selection_range JSON,
    user_color VARCHAR(7),
    permissions JSON, -- ç”¨æˆ·åœ¨æ­¤æ–‡æ¡£çš„æƒé™
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_activity TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_document (document_id, document_type),
    INDEX idx_user (user_id),
    INDEX idx_activity (last_activity),
    INDEX idx_session_token (session_token)
);

-- æ“ä½œæ—¥å¿—è¡¨
CREATE TABLE operation_logs (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    document_id VARCHAR(36) NOT NULL,
    document_type VARCHAR(50) NOT NULL,
    user_id VARCHAR(36) NOT NULL,
    operation_type VARCHAR(50) NOT NULL,
    operation_data JSON NOT NULL,
    timestamp TIMESTAMP(3) DEFAULT CURRENT_TIMESTAMP(3),
    sequence_number BIGINT AUTO_INCREMENT,
    applied BOOLEAN DEFAULT TRUE,
    conflicts_with JSON,
    conflict_resolution JSON,
    
    INDEX idx_document (document_id, document_type),
    INDEX idx_timestamp (timestamp),
    INDEX idx_sequence (sequence_number),
    INDEX idx_user (user_id)
);

-- æ–‡æ¡£é”è¡¨
CREATE TABLE document_locks (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    document_id VARCHAR(36) NOT NULL,
    document_type VARCHAR(50) NOT NULL,
    locked_by VARCHAR(36) NOT NULL,
    lock_type ENUM('read', 'write', 'exclusive') NOT NULL,
    locked_elements JSON,
    locked_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP NOT NULL,
    
    UNIQUE(document_id, document_type, locked_by),
    INDEX idx_expires (expires_at),
    INDEX idx_document (document_id, document_type)
);

-- åä½œç»Ÿè®¡è¡¨
CREATE TABLE collaboration_statistics (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    document_id VARCHAR(36) NOT NULL,
    document_type VARCHAR(50) NOT NULL,
    date DATE NOT NULL,
    active_users INT DEFAULT 0,
    total_operations INT DEFAULT 0,
    conflicts_resolved INT DEFAULT 0,
    avg_session_duration INT DEFAULT 0,
    
    UNIQUE(document_id, document_type, date),
    INDEX idx_document_date (document_id, document_type, date)
);
```

#### æ¥å£è®¾è®¡
```yaml
# åä½œä¼šè¯ç®¡ç†
POST /collaboration/join               # åŠ å…¥åä½œä¼šè¯
POST /collaboration/leave              # ç¦»å¼€åä½œä¼šè¯
GET /collaboration/sessions/{document_id} # è·å–æ–‡æ¡£åä½œçŠ¶æ€
GET /collaboration/active-users/{document_id} # è·å–åœ¨çº¿ç”¨æˆ·åˆ—è¡¨
POST /collaboration/heartbeat          # å‘é€å¿ƒè·³ä¿æŒä¼šè¯

# å®æ—¶æ“ä½œ
POST /collaboration/operations         # æäº¤æ“ä½œ
GET /collaboration/operations/{document_id} # è·å–æ“ä½œå†å²
POST /collaboration/cursor-update      # æ›´æ–°å…‰æ ‡ä½ç½®
POST /collaboration/selection-update   # æ›´æ–°é€‰æ‹©èŒƒå›´

# å†²çªè§£å†³
POST /collaboration/resolve-conflict   # è§£å†³å†²çª
GET /collaboration/conflicts/{document_id} # è·å–å†²çªåˆ—è¡¨
POST /collaboration/force-resolve      # å¼ºåˆ¶è§£å†³å†²çª

# æ–‡æ¡£é”å®š
POST /collaboration/lock               # é”å®šæ–‡æ¡£æˆ–å…ƒç´ 
POST /collaboration/unlock             # è§£é”æ–‡æ¡£æˆ–å…ƒç´ 
GET /collaboration/locks/{document_id} # è·å–é”å®šçŠ¶æ€
POST /collaboration/force-unlock       # å¼ºåˆ¶è§£é”

# åä½œæƒé™
GET /collaboration/permissions/{document_id} # è·å–åä½œæƒé™
POST /collaboration/grant-permission   # æˆäºˆåä½œæƒé™
POST /collaboration/revoke-permission  # æ’¤é”€åä½œæƒé™

# WebSocketæ¥å£
WS /collaboration/connect              # å»ºç«‹WebSocketè¿æ¥
```

### 12. ç‰ˆæœ¬æ§åˆ¶æœåŠ¡ (version-control-service)
**èŒè´£**: ç‰ˆæœ¬ç®¡ç†ã€åˆ†æ”¯ç®¡ç†ã€åˆå¹¶ç®¡ç†ã€å˜æ›´è·Ÿè¸ª

#### æ•°æ®åº“è®¾è®¡ (MySQL)
```sql
-- ç‰ˆæœ¬åˆ†æ”¯è¡¨
CREATE TABLE version_branches (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    document_id VARCHAR(36) NOT NULL,
    document_type VARCHAR(50) NOT NULL,
    branch_name VARCHAR(255) NOT NULL,
    parent_branch_id VARCHAR(36) NULL,
    head_commit_id VARCHAR(36) NULL,
    is_protected BOOLEAN DEFAULT FALSE,
    protection_rules JSON,
    created_by VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE(document_id, document_type, branch_name),
    FOREIGN KEY (parent_branch_id) REFERENCES version_branches(id),
    INDEX idx_document (document_id, document_type),
    INDEX idx_created_by (created_by)
);

-- ç‰ˆæœ¬æäº¤è¡¨
CREATE TABLE version_commits (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    branch_id VARCHAR(36) NOT NULL,
    commit_hash VARCHAR(64) UNIQUE NOT NULL,
    parent_commit_id VARCHAR(36) NULL,
    author_id VARCHAR(36) NOT NULL,
    commit_message TEXT NOT NULL,
    document_snapshot JSON NOT NULL,
    changes_summary JSON,
    is_merge_commit BOOLEAN DEFAULT FALSE,
    merge_from_branch VARCHAR(36) NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (branch_id) REFERENCES version_branches(id),
    FOREIGN KEY (parent_commit_id) REFERENCES version_commits(id),
    INDEX idx_branch (branch_id),
    INDEX idx_hash (commit_hash),
    INDEX idx_author (author_id)
);

-- åˆå¹¶è¯·æ±‚è¡¨
CREATE TABLE merge_requests (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    source_branch_id VARCHAR(36) NOT NULL,
    target_branch_id VARCHAR(36) NOT NULL,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    status ENUM('open', 'merged', 'closed', 'draft') NOT NULL DEFAULT 'open',
    conflicts JSON,
    review_required BOOLEAN DEFAULT TRUE,
    created_by VARCHAR(36) NOT NULL,
    assignee_id VARCHAR(36) NULL,
    reviewers JSON,
    approvals JSON,
    merged_by VARCHAR(36) NULL,
    merge_commit_id VARCHAR(36) NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    merged_at TIMESTAMP NULL,
    
    FOREIGN KEY (source_branch_id) REFERENCES version_branches(id),
    FOREIGN KEY (target_branch_id) REFERENCES version_branches(id),
    FOREIGN KEY (merge_commit_id) REFERENCES version_commits(id),
    INDEX idx_status (status),
    INDEX idx_created_by (created_by),
    INDEX idx_assignee (assignee_id)
);

-- ç‰ˆæœ¬æ ‡ç­¾è¡¨
CREATE TABLE version_tags (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    document_id VARCHAR(36) NOT NULL,
    document_type VARCHAR(50) NOT NULL,
    tag_name VARCHAR(255) NOT NULL,
    commit_id VARCHAR(36) NOT NULL,
    tag_type ENUM('release', 'milestone', 'hotfix') DEFAULT 'milestone',
    description TEXT,
    created_by VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE(document_id, document_type, tag_name),
    FOREIGN KEY (commit_id) REFERENCES version_commits(id),
    INDEX idx_document (document_id, document_type),
    INDEX idx_tag_type (tag_type)
);

-- ä»£ç å®¡æŸ¥è¡¨
CREATE TABLE code_reviews (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    merge_request_id VARCHAR(36) NOT NULL,
    reviewer_id VARCHAR(36) NOT NULL,
    status ENUM('pending', 'approved', 'rejected', 'needs_changes') DEFAULT 'pending',
    comments TEXT,
    reviewed_at TIMESTAMP NULL,
    
    UNIQUE(merge_request_id, reviewer_id),
    FOREIGN KEY (merge_request_id) REFERENCES merge_requests(id) ON DELETE CASCADE,
    INDEX idx_reviewer (reviewer_id),
    INDEX idx_status (status)
);
```

#### æ¥å£è®¾è®¡
```yaml
# åˆ†æ”¯ç®¡ç†
GET /version-control/{document_id}/branches # è·å–åˆ†æ”¯åˆ—è¡¨
POST /version-control/{document_id}/branches # åˆ›å»ºåˆ†æ”¯
GET /version-control/branches/{branch_id}   # è·å–åˆ†æ”¯è¯¦æƒ…
PUT /version-control/branches/{branch_id}   # æ›´æ–°åˆ†æ”¯è®¾ç½®
DELETE /version-control/branches/{branch_id} # åˆ é™¤åˆ†æ”¯
POST /version-control/branches/{branch_id}/protect # ä¿æŠ¤åˆ†æ”¯

# æäº¤ç®¡ç†
GET /version-control/{document_id}/commits  # è·å–æäº¤å†å²
POST /version-control/{document_id}/commits # åˆ›å»ºæäº¤
GET /version-control/commits/{commit_id}    # è·å–æäº¤è¯¦æƒ…
POST /version-control/commits/{commit_id}/revert # å›æ»šæäº¤

# ç‰ˆæœ¬æ¯”è¾ƒ
GET /version-control/{document_id}/diff     # æ¯”è¾ƒç‰ˆæœ¬å·®å¼‚
POST /version-control/compare               # æ¯”è¾ƒä»»æ„ä¸¤ä¸ªç‰ˆæœ¬
GET /version-control/commits/{commit_id}/diff # è·å–æäº¤å·®å¼‚

# åˆå¹¶è¯·æ±‚
GET /version-control/merge-requests         # è·å–åˆå¹¶è¯·æ±‚åˆ—è¡¨
POST /version-control/merge-requests        # åˆ›å»ºåˆå¹¶è¯·æ±‚
GET /version-control/merge-requests/{mr_id} # è·å–åˆå¹¶è¯·æ±‚è¯¦æƒ…
PUT /version-control/merge-requests/{mr_id} # æ›´æ–°åˆå¹¶è¯·æ±‚
POST /version-control/merge-requests/{mr_id}/merge # æ‰§è¡Œåˆå¹¶
POST /version-control/merge-requests/{mr_id}/close # å…³é—­åˆå¹¶è¯·æ±‚

# æ ‡ç­¾ç®¡ç†
GET /version-control/{document_id}/tags     # è·å–æ ‡ç­¾åˆ—è¡¨
POST /version-control/{document_id}/tags    # åˆ›å»ºæ ‡ç­¾
DELETE /version-control/tags/{tag_id}       # åˆ é™¤æ ‡ç­¾
GET /version-control/tags/{tag_id}/commits  # è·å–æ ‡ç­¾ç›¸å…³æäº¤

# ä»£ç å®¡æŸ¥
POST /version-control/merge-requests/{mr_id}/review # æäº¤å®¡æŸ¥
GET /version-control/merge-requests/{mr_id}/reviews # è·å–å®¡æŸ¥åˆ—è¡¨
PUT /version-control/reviews/{review_id}    # æ›´æ–°å®¡æŸ¥çŠ¶æ€
```

### 13. æ–‡ä»¶æœåŠ¡ (file-service)
**èŒè´£**: æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€ç®¡ç†ã€é¢„è§ˆã€è½¬æ¢ã€ç‰ˆæœ¬æ§åˆ¶

#### æ•°æ®åº“è®¾è®¡ (MySQL)
```sql
-- æ–‡ä»¶è¡¨
CREATE TABLE files (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    name VARCHAR(255) NOT NULL,
    original_name VARCHAR(255) NOT NULL,
    path VARCHAR(500) NOT NULL,
    size BIGINT NOT NULL,
    mime_type VARCHAR(100),
    file_hash VARCHAR(64),
    thumbnail_path VARCHAR(500),
    preview_path VARCHAR(500),
    project_id VARCHAR(36) NULL,
    folder_id VARCHAR(36) NULL,
    is_public BOOLEAN DEFAULT FALSE,
    download_count INT DEFAULT 0,
    virus_scan_status ENUM('pending', 'clean', 'infected', 'error') DEFAULT 'pending',
    virus_scan_date TIMESTAMP NULL,
    uploaded_by VARCHAR(36) NOT NULL,
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_project (project_id),
    INDEX idx_folder (folder_id),
    INDEX idx_hash (file_hash),
    INDEX idx_uploaded_by (uploaded_by),
    INDEX idx_mime_type (mime_type)
);

-- æ–‡ä»¶å¤¹è¡¨
CREATE TABLE file_folders (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    name VARCHAR(255) NOT NULL,
    parent_id VARCHAR(36) NULL,
    project_id VARCHAR(36) NOT NULL,
    path VARCHAR(1000) NOT NULL,
    description TEXT,
    created_by VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (parent_id) REFERENCES file_folders(id) ON DELETE CASCADE,
    INDEX idx_parent (parent_id),
    INDEX idx_project (project_id),
    INDEX idx_path (path(255))
);

-- æ–‡ä»¶åˆ†äº«è¡¨
CREATE TABLE file_shares (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    file_id VARCHAR(36) NOT NULL,
    share_token VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NULL,
    expires_at TIMESTAMP NULL,
    max_downloads INT NULL,
    download_count INT DEFAULT 0,
    allow_preview BOOLEAN DEFAULT TRUE,
    allow_download BOOLEAN DEFAULT TRUE,
    created_by VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (file_id) REFERENCES files(id) ON DELETE CASCADE,
    INDEX idx_token (share_token),
    INDEX idx_expires (expires_at),
    INDEX idx_file (file_id)
);

-- æ–‡ä»¶ç‰ˆæœ¬è¡¨
CREATE TABLE file_versions (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    file_id VARCHAR(36) NOT NULL,
    version_number INT NOT NULL,
    path VARCHAR(500) NOT NULL,
    size BIGINT NOT NULL,
    file_hash VARCHAR(64),
    change_description TEXT,
    uploaded_by VARCHAR(36) NOT NULL,
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (file_id) REFERENCES files(id) ON DELETE CASCADE,
    UNIQUE(file_id, version_number),
    INDEX idx_file_version (file_id, version_number DESC)
);

-- æ–‡ä»¶è®¿é—®æ—¥å¿—è¡¨
CREATE TABLE file_access_logs (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    file_id VARCHAR(36) NOT NULL,
    user_id VARCHAR(36),
    access_type ENUM('view', 'download', 'preview') NOT NULL,
    ip_address VARCHAR(45),
    user_agent TEXT,
    accessed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_file (file_id),
    INDEX idx_user (user_id),
    INDEX idx_access_type (access_type),
    INDEX idx_accessed_at (accessed_at)
);
```

#### æ¥å£è®¾è®¡
```yaml
# æ–‡ä»¶ä¸Šä¼ 
POST /files/upload                   # å•æ–‡ä»¶ä¸Šä¼ 
POST /files/upload/chunk             # åˆ†å—ä¸Šä¼ 
POST /files/upload/complete          # å®Œæˆåˆ†å—ä¸Šä¼ 
POST /files/upload/multiple          # æ‰¹é‡ä¸Šä¼ 

# æ–‡ä»¶ç®¡ç†
GET /files/{file_id}                 # è·å–æ–‡ä»¶ä¿¡æ¯
PUT /files/{file_id}                 # æ›´æ–°æ–‡ä»¶ä¿¡æ¯
DELETE /files/{file_id}              # åˆ é™¤æ–‡ä»¶
POST /files/{file_id}/copy           # å¤åˆ¶æ–‡ä»¶
POST /files/{file_id}/move           # ç§»åŠ¨æ–‡ä»¶

# æ–‡ä»¶è®¿é—®
GET /files/{file_id}/download        # ä¸‹è½½æ–‡ä»¶
GET /files/{file_id}/preview         # é¢„è§ˆæ–‡ä»¶
GET /files/{file_id}/thumbnail       # è·å–ç¼©ç•¥å›¾
GET /files/{file_id}/stream          # æµå¼è®¿é—®æ–‡ä»¶

# æ–‡ä»¶ç‰ˆæœ¬
GET /files/{file_id}/versions        # è·å–ç‰ˆæœ¬åˆ—è¡¨
POST /files/{file_id}/versions       # ä¸Šä¼ æ–°ç‰ˆæœ¬
GET /files/{file_id}/versions/{version} # ä¸‹è½½æŒ‡å®šç‰ˆæœ¬
POST /files/{file_id}/restore/{version} # æ¢å¤åˆ°æŒ‡å®šç‰ˆæœ¬

# æ–‡ä»¶åˆ†äº«
POST /files/{file_id}/share          # åˆ›å»ºåˆ†äº«é“¾æ¥
GET /files/shared/{share_token}      # è®¿é—®åˆ†äº«æ–‡ä»¶
PUT /shares/{share_id}               # æ›´æ–°åˆ†äº«è®¾ç½®
DELETE /shares/{share_id}            # åˆ é™¤åˆ†äº«

# æ–‡ä»¶å¤¹ç®¡ç†
POST /folders                        # åˆ›å»ºæ–‡ä»¶å¤¹
GET /folders/{folder_id}             # è·å–æ–‡ä»¶å¤¹å†…å®¹
PUT /folders/{folder_id}             # æ›´æ–°æ–‡ä»¶å¤¹
DELETE /folders/{folder_id}          # åˆ é™¤æ–‡ä»¶å¤¹

# é¡¹ç›®æ–‡ä»¶
GET /projects/{project_id}/files     # è·å–é¡¹ç›®æ–‡ä»¶åˆ—è¡¨
GET /projects/{project_id}/storage-usage # è·å–å­˜å‚¨ä½¿ç”¨æƒ…å†µ

# æ–‡ä»¶è½¬æ¢
POST /files/{file_id}/convert        # æ–‡ä»¶æ ¼å¼è½¬æ¢
GET /files/{file_id}/convert-status  # è·å–è½¬æ¢çŠ¶æ€
GET /files/{file_id}/convert-result  # è·å–è½¬æ¢ç»“æœ
```

### 14. æœç´¢æœåŠ¡ (search-service)
**èŒè´£**: å…¨å±€æœç´¢ã€æ™ºèƒ½æ¨èã€å†…å®¹åˆ†æã€æœç´¢ä¼˜åŒ–

#### æ•°æ®åº“è®¾è®¡ (Elasticsearch)
```json
// ç»Ÿä¸€æœç´¢ç´¢å¼•
{
  "platform_resources": {
    "mappings": {
      "properties": {
        "id": {"type": "keyword"},
        "resource_type": {"type": "keyword"},
        "project_id": {"type": "keyword"},
        "team_id": {"type": "keyword"},
        "title": {
          "type": "text",
          "analyzer": "ik_max_word",
          "search_analyzer": "ik_smart",
          "fields": {
            "keyword": {"type": "keyword"}
          }
        },
        "content": {
          "type": "text",
          "analyzer": "ik_max_word"
        },
        "description": {
          "type": "text",
          "analyzer": "ik_max_word"
        },
        "tags": {"type": "keyword"},
        "creator_id": {"type": "keyword"},
        "created_at": {"type": "date"},
        "updated_at": {"type": "date"},
        "permissions": {
          "type": "nested",
          "properties": {
            "user_id": {"type": "keyword"},
            "access_level": {"type": "keyword"}
          }
        },
        "metadata": {"type": "object"},
        "suggest": {
          "type": "completion",
          "analyzer": "simple",
          "preserve_separators": true,
          "preserve_position_increments": true,
          "max_input_length": 50
        },
        "popularity_score": {"type": "float"},
        "search_boost": {"type": "float"}
      }
    }
  }
}
```

#### æ¥å£è®¾è®¡
```yaml
# å…¨å±€æœç´¢
GET /search                          # å…¨å±€æœç´¢
GET /search/suggest                  # æœç´¢å»ºè®®
GET /search/recent                   # æœ€è¿‘æœç´¢
GET /search/trending                 # çƒ­é—¨æœç´¢
POST /search/feedback                # æœç´¢åé¦ˆ

# é«˜çº§æœç´¢
POST /search/advanced                # é«˜çº§æœç´¢
GET /search/filters                  # è·å–å¯ç”¨è¿‡æ»¤å™¨
POST /search/faceted                 # åˆ†é¢æœç´¢

# ä¸ªæ€§åŒ–æœç´¢
GET /search/recommendations          # ä¸ªæ€§åŒ–æ¨è
GET /search/related/{resource_id}    # ç›¸å…³å†…å®¹æ¨è
POST /search/bookmark                # æ”¶è—æœç´¢ç»“æœ

# æœç´¢åˆ†æ
GET /search/analytics                # æœç´¢åˆ†ææŠ¥å‘Š
GET /search/popular-terms            # çƒ­é—¨æœç´¢è¯
GET /search/user-behavior            # ç”¨æˆ·æœç´¢è¡Œä¸ºåˆ†æ

# å†…éƒ¨æ¥å£
POST /internal/search/index          # ç´¢å¼•èµ„æº
PUT /internal/search/index/{id}      # æ›´æ–°ç´¢å¼•
DELETE /internal/search/index/{id}   # åˆ é™¤ç´¢å¼•
POST /internal/search/bulk-index     # æ‰¹é‡ç´¢å¼•
POST /internal/search/reindex        # é‡å»ºç´¢å¼•
```

### 15. é›†æˆæœåŠ¡ (integration-service)
**èŒè´£**: å¤–éƒ¨ç³»ç»Ÿé›†æˆã€Webhookç®¡ç†ã€æ’ä»¶ç³»ç»Ÿã€æ•°æ®åŒæ­¥

#### æ•°æ®åº“è®¾è®¡ (MySQL)
```sql
-- Webhooké…ç½®è¡¨
CREATE TABLE webhooks (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    project_id VARCHAR(36) NOT NULL,
    name VARCHAR(255) NOT NULL,
    url VARCHAR(500) NOT NULL,
    events JSON NOT NULL,
    headers JSON,
    secret VARCHAR(255),
    is_active BOOLEAN DEFAULT TRUE,
    retry_config JSON,
    timeout_seconds INT DEFAULT 30,
    last_triggered_at TIMESTAMP NULL,
    success_count INT DEFAULT 0,
    failure_count INT DEFAULT 0,
    created_by VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_project (project_id),
    INDEX idx_active (is_active),
    INDEX idx_created_by (created_by)
);

-- Webhookæ‰§è¡Œæ—¥å¿—è¡¨
CREATE TABLE webhook_logs (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    webhook_id VARCHAR(36) NOT NULL,
    event_type VARCHAR(100) NOT NULL,
    payload JSON NOT NULL,
    response_status INT,
    response_body TEXT,
    response_headers JSON,
    execution_time_ms INT,
    error_message TEXT,
    retry_count INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (webhook_id) REFERENCES webhooks(id) ON DELETE CASCADE,
    INDEX idx_webhook (webhook_id),
    INDEX idx_event (event_type),
    INDEX idx_status (response_status),
    INDEX idx_created (created_at)
);

-- æ’ä»¶ç®¡ç†è¡¨
CREATE TABLE plugins (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    name VARCHAR(255) UNIQUE NOT NULL,
    version VARCHAR(50) NOT NULL,
    description TEXT,
    author VARCHAR(255),
    repository_url VARCHAR(500),
    documentation_url VARCHAR(500),
    manifest JSON NOT NULL,
    permissions JSON,
    configuration_schema JSON,
    is_enabled BOOLEAN DEFAULT TRUE,
    is_verified BOOLEAN DEFAULT FALSE,
    verification_date DATE,
    download_count INT DEFAULT 0,
    rating DECIMAL(3,2) DEFAULT 0.00,
    review_count INT DEFAULT 0,
    installed_by VARCHAR(36) NOT NULL,
    installed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_enabled (is_enabled),
    INDEX idx_verified (is_verified),
    INDEX idx_rating (rating DESC),
    INDEX idx_downloads (download_count DESC)
);

-- æ’ä»¶é…ç½®è¡¨
CREATE TABLE plugin_configurations (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    plugin_id VARCHAR(36) NOT NULL,
    project_id VARCHAR(36) NULL,
    configuration JSON NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_by VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    FOREIGN KEY (plugin_id) REFERENCES plugins(id) ON DELETE CASCADE,
    INDEX idx_plugin_project (plugin_id, project_id),
    INDEX idx_active (is_active)
);

-- å¤–éƒ¨é›†æˆé…ç½®è¡¨
CREATE TABLE external_integrations (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    project_id VARCHAR(36) NOT NULL,
    integration_type VARCHAR(100) NOT NULL,
    name VARCHAR(255) NOT NULL,
    configuration JSON NOT NULL,
    auth_config JSON,
    sync_settings JSON,
    status ENUM('active', 'inactive', 'error') DEFAULT 'active',
    last_sync_at TIMESTAMP NULL,
    sync_error_message TEXT,
    created_by VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_project_type (project_id, integration_type),
    INDEX idx_status (status),
    INDEX idx_last_sync (last_sync_at)
);

-- é›†æˆåŒæ­¥æ—¥å¿—è¡¨
CREATE TABLE integration_sync_logs (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    integration_id VARCHAR(36) NOT NULL,
    sync_type VARCHAR(100) NOT NULL,
    status ENUM('success', 'failure', 'partial') NOT NULL,
    records_processed INT DEFAULT 0,
    errors_count INT DEFAULT 0,
    sync_details JSON,
    error_details JSON,
    started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP NULL,
    
    FOREIGN KEY (integration_id) REFERENCES external_integrations(id) ON DELETE CASCADE,
    INDEX idx_integration (integration_id),
    INDEX idx_status (status),
    INDEX idx_started (started_at)
);
```

#### æ¥å£è®¾è®¡
```yaml
# Webhookç®¡ç†
GET /integrations/webhooks             # è·å–Webhookåˆ—è¡¨
POST /integrations/webhooks            # åˆ›å»ºWebhook
GET /integrations/webhooks/{webhook_id} # è·å–Webhookè¯¦æƒ…
PUT /integrations/webhooks/{webhook_id} # æ›´æ–°Webhook
DELETE /integrations/webhooks/{webhook_id} # åˆ é™¤Webhook
POST /integrations/webhooks/{webhook_id}/test # æµ‹è¯•Webhook

# Webhookæ—¥å¿—
GET /integrations/webhooks/{webhook_id}/logs # è·å–æ‰§è¡Œæ—¥å¿—
POST /integrations/webhooks/{webhook_id}/retry # é‡è¯•å¤±è´¥çš„è°ƒç”¨

# æ’ä»¶ç®¡ç†
GET /integrations/plugins              # è·å–æ’ä»¶åˆ—è¡¨
GET /integrations/plugins/marketplace  # è·å–æ’ä»¶å¸‚åœº
POST /integrations/plugins/install     # å®‰è£…æ’ä»¶
POST /integrations/plugins/uninstall   # å¸è½½æ’ä»¶
GET /integrations/plugins/{plugin_id}  # è·å–æ’ä»¶è¯¦æƒ…
PUT /integrations/plugins/{plugin_id}/config # æ›´æ–°æ’ä»¶é…ç½®

# å¤–éƒ¨é›†æˆ
GET /integrations/external             # è·å–å¤–éƒ¨é›†æˆåˆ—è¡¨
POST /integrations/external            # åˆ›å»ºå¤–éƒ¨é›†æˆ
GET /integrations/external/{integration_id} # è·å–é›†æˆè¯¦æƒ…
PUT /integrations/external/{integration_id} # æ›´æ–°é›†æˆé…ç½®
DELETE /integrations/external/{integration_id} # åˆ é™¤é›†æˆ
POST /integrations/external/{integration_id}/sync # æ‰‹åŠ¨åŒæ­¥
GET /integrations/external/{integration_id}/logs # è·å–åŒæ­¥æ—¥å¿—

# æ”¯æŒçš„é›†æˆç±»å‹
GET /integrations/types                # è·å–æ”¯æŒçš„é›†æˆç±»å‹
GET /integrations/types/{type}/schema  # è·å–é›†æˆé…ç½®æ¶æ„
GET /integrations/types/{type}/auth    # è·å–è®¤è¯é…ç½®
```

### 16. é€šçŸ¥æœåŠ¡ (notification-service)
**èŒè´£**: æ¶ˆæ¯é€šçŸ¥ã€é‚®ä»¶å‘é€ã€æ¨é€ç®¡ç†ã€é€šçŸ¥åå¥½

#### æ•°æ®åº“è®¾è®¡ (MySQL + Redis)
```sql
-- é€šçŸ¥æ¨¡æ¿è¡¨
CREATE TABLE notification_templates (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    name VARCHAR(255) UNIQUE NOT NULL,
    type VARCHAR(100) NOT NULL,
    event_type VARCHAR(100) NOT NULL,
    subject_template TEXT,
    content_template TEXT NOT NULL,
    html_template TEXT,
    variables JSON,
    is_active BOOLEAN DEFAULT TRUE,
    locale VARCHAR(10) DEFAULT 'en',
    created_by VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_event (event_type),
    INDEX idx_type (type),
    INDEX idx_locale (locale),
    INDEX idx_active (is_active)
);

-- ç”¨æˆ·é€šçŸ¥åå¥½è¡¨
CREATE TABLE user_notification_preferences (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    user_id VARCHAR(36) NOT NULL,
    event_type VARCHAR(100) NOT NULL,
    email_enabled BOOLEAN DEFAULT TRUE,
    in_app_enabled BOOLEAN DEFAULT TRUE,
    push_enabled BOOLEAN DEFAULT FALSE,
    sms_enabled BOOLEAN DEFAULT FALSE,
    frequency VARCHAR(50) DEFAULT 'immediate',
    quiet_hours_start TIME,
    quiet_hours_end TIME,
    timezone VARCHAR(50),
    
    UNIQUE(user_id, event_type),
    INDEX idx_user (user_id),
    INDEX idx_event (event_type)
);

-- é€šçŸ¥è®°å½•è¡¨
CREATE TABLE notifications (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    user_id VARCHAR(36) NOT NULL,
    type VARCHAR(100) NOT NULL,
    priority ENUM('low', 'normal', 'high', 'urgent') DEFAULT 'normal',
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    data JSON,
    is_read BOOLEAN DEFAULT FALSE,
    read_at TIMESTAMP NULL,
    expires_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_user_read (user_id, is_read),
    INDEX idx_created (created_at),
    INDEX idx_priority (priority),
    INDEX idx_expires (expires_at)
);

-- é‚®ä»¶é˜Ÿåˆ—è¡¨
CREATE TABLE email_queue (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    to_email VARCHAR(255) NOT NULL,
    to_name VARCHAR(255),
    from_email VARCHAR(255),
    from_name VARCHAR(255),
    subject VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    html_content TEXT,
    template_id VARCHAR(36) NULL,
    template_data JSON,
    attachments JSON,
    priority ENUM('low', 'normal', 'high') DEFAULT 'normal',
    status ENUM('pending', 'processing', 'sent', 'failed') DEFAULT 'pending',
    retry_count INT DEFAULT 0,
    max_retries INT DEFAULT 3,
    error_message TEXT,
    scheduled_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    sent_at TIMESTAMP NULL,
    
    INDEX idx_status (status),
    INDEX idx_scheduled (scheduled_at),
    INDEX idx_priority (priority)
);

-- æ¨é€é€šçŸ¥è¡¨
CREATE TABLE push_notifications (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    user_id VARCHAR(36) NOT NULL,
    device_token VARCHAR(500) NOT NULL,
    title VARCHAR(255) NOT NULL,
    body TEXT NOT NULL,
    data JSON,
    status ENUM('pending', 'sent', 'failed') DEFAULT 'pending',
    error_message TEXT,
    sent_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_user (user_id),
    INDEX idx_status (status),
    INDEX idx_device_token (device_token)
);

-- è®¾å¤‡ä»¤ç‰Œè¡¨
CREATE TABLE user_devices (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    user_id VARCHAR(36) NOT NULL,
    device_token VARCHAR(500) NOT NULL,
    device_type ENUM('ios', 'android', 'web') NOT NULL,
    device_name VARCHAR(255),
    is_active BOOLEAN DEFAULT TRUE,
    registered_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_used_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE(user_id, device_token),
    INDEX idx_user (user_id),
    INDEX idx_active (is_active)
);
```

#### æ¥å£è®¾è®¡
```yaml
# ç”¨æˆ·é€šçŸ¥
GET /notifications                   # è·å–ç”¨æˆ·é€šçŸ¥åˆ—è¡¨
PUT /notifications/{notification_id}/read # æ ‡è®°é€šçŸ¥ä¸ºå·²è¯»
POST /notifications/mark-all-read    # æ ‡è®°æ‰€æœ‰é€šçŸ¥ä¸ºå·²è¯»
DELETE /notifications/{notification_id} # åˆ é™¤é€šçŸ¥
GET /notifications/unread-count      # è·å–æœªè¯»é€šçŸ¥æ•°é‡

# é€šçŸ¥åå¥½
GET /notifications/preferences       # è·å–é€šçŸ¥åå¥½
PUT /notifications/preferences       # æ›´æ–°é€šçŸ¥åå¥½
POST /notifications/preferences/reset # é‡ç½®ä¸ºé»˜è®¤è®¾ç½®

# è®¾å¤‡ç®¡ç†
GET /notifications/devices           # è·å–è®¾å¤‡åˆ—è¡¨
POST /notifications/devices          # æ³¨å†Œè®¾å¤‡
DELETE /notifications/devices/{device_id} # å–æ¶ˆè®¾å¤‡æ³¨å†Œ

# é€šçŸ¥æ¨¡æ¿ç®¡ç†ï¼ˆç®¡ç†å‘˜ï¼‰
GET /admin/notification-templates    # è·å–æ¨¡æ¿åˆ—è¡¨
POST /admin/notification-templates   # åˆ›å»ºæ¨¡æ¿
PUT /admin/notification-templates/{template_id} # æ›´æ–°æ¨¡æ¿
DELETE /admin/notification-templates/{template_id} # åˆ é™¤æ¨¡æ¿

# å†…éƒ¨å‘é€æ¥å£
POST /internal/notifications/send    # å‘é€é€šçŸ¥
POST /internal/notifications/email   # å‘é€é‚®ä»¶
POST /internal/notifications/push    # å‘é€æ¨é€
POST /internal/notifications/bulk    # æ‰¹é‡å‘é€é€šçŸ¥
```

### 17. å®¡è®¡æœåŠ¡ (audit-service)
**èŒè´£**: æ“ä½œå®¡è®¡ã€åˆè§„ç®¡ç†ã€å®‰å…¨ç›‘æ§ã€æ•°æ®æ²»ç†

#### æ•°æ®åº“è®¾è®¡ (MySQL + Elasticsearch)
```sql
-- å®¡è®¡æ—¥å¿—è¡¨
CREATE TABLE audit_logs (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    user_id VARCHAR(36),
    session_id VARCHAR(36),
    action VARCHAR(100) NOT NULL,
    resource_type VARCHAR(50) NOT NULL,
    resource_id VARCHAR(36) NOT NULL,
    old_values JSON,
    new_values JSON,
    ip_address VARCHAR(45),
    user_agent TEXT,
    request_id VARCHAR(36),
    result ENUM('success', 'failure', 'error') NOT NULL,
    error_message TEXT,
    execution_time_ms INT,
    risk_level ENUM('low', 'medium', 'high', 'critical') DEFAULT 'low',
    tags JSON,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_user (user_id),
    INDEX idx_resource (resource_type, resource_id),
    INDEX idx_action (action),
    INDEX idx_timestamp (timestamp),
    INDEX idx_result (result),
    INDEX idx_risk_level (risk_level)
);

-- å®‰å…¨äº‹ä»¶è¡¨
CREATE TABLE security_events (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    event_type VARCHAR(100) NOT NULL,
    severity ENUM('low', 'medium', 'high', 'critical') NOT NULL,
    user_id VARCHAR(36),
    ip_address VARCHAR(45),
    details JSON NOT NULL,
    status ENUM('open', 'investigating', 'resolved', 'false_positive') DEFAULT 'open',
    assigned_to VARCHAR(36),
    resolution_notes TEXT,
    resolved_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_type (event_type),
    INDEX idx_severity (severity),
    INDEX idx_status (status),
    INDEX idx_user (user_id),
    INDEX idx_assigned (assigned_to)
);

-- åˆè§„æŠ¥å‘Šè¡¨
CREATE TABLE compliance_reports (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    report_type VARCHAR(100) NOT NULL,
    report_name VARCHAR(255) NOT NULL,
    period_start DATE NOT NULL,
    period_end DATE NOT NULL,
    report_data JSON NOT NULL,
    file_path VARCHAR(500),
    status ENUM('generating', 'completed', 'failed') DEFAULT 'generating',
    generated_by VARCHAR(36) NOT NULL,
    generated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_type_period (report_type, period_start, period_end),
    INDEX idx_status (status),
    INDEX idx_generated_by (generated_by)
);

-- æ•°æ®ä¿ç•™ç­–ç•¥è¡¨
CREATE TABLE data_retention_policies (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    resource_type VARCHAR(100) NOT NULL,
    retention_days INT NOT NULL,
    archive_after_days INT,
    auto_delete BOOLEAN DEFAULT FALSE,
    policy_description TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    created_by VARCHAR(36) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE(resource_type),
    INDEX idx_active (is_active)
);

-- å®¡è®¡é…ç½®è¡¨
CREATE TABLE audit_configurations (
    id VARCHAR(36) PRIMARY KEY DEFAULT (UUID()),
    service_name VARCHAR(100) NOT NULL,
    action_type VARCHAR(100) NOT NULL,
    is_enabled BOOLEAN DEFAULT TRUE,
    log_level ENUM('basic', 'detailed', 'full') DEFAULT 'basic',
    include_request_data BOOLEAN DEFAULT FALSE,
    include_response_data BOOLEAN DEFAULT FALSE,
    retention_days INT DEFAULT 90,
    
    UNIQUE(service_name, action_type),
    INDEX idx_enabled (is_enabled)
);
```

#### æ¥å£è®¾è®¡
```yaml
# å®¡è®¡æ—¥å¿—æŸ¥è¯¢
GET /audit/logs                     # è·å–å®¡è®¡æ—¥å¿—
GET /audit/logs/search               # æœç´¢å®¡è®¡æ—¥å¿—
GET /audit/logs/export               # å¯¼å‡ºå®¡è®¡æ—¥å¿—
GET /audit/logs/statistics           # è·å–å®¡è®¡ç»Ÿè®¡

# å®‰å…¨äº‹ä»¶ç®¡ç†
GET /audit/security-events          # è·å–å®‰å…¨äº‹ä»¶
POST /audit/security-events/{event_id}/investigate # å¼€å§‹è°ƒæŸ¥
POST /audit/security-events/{event_id}/resolve # è§£å†³äº‹ä»¶
PUT /audit/security-events/{event_id}/assign # åˆ†é…äº‹ä»¶

# åˆè§„æŠ¥å‘Š
GET /audit/compliance-reports        # è·å–åˆè§„æŠ¥å‘Šåˆ—è¡¨
POST /audit/compliance-reports/generate # ç”Ÿæˆåˆè§„æŠ¥å‘Š
GET /audit/compliance-reports/{report_id} # ä¸‹è½½æŠ¥å‘Š
DELETE /audit/compliance-reports/{report_id} # åˆ é™¤æŠ¥å‘Š

# å®¡è®¡é…ç½®
GET /audit/config                    # è·å–å®¡è®¡é…ç½®
PUT /audit/config                    # æ›´æ–°å®¡è®¡é…ç½®
GET /audit/retention-policies        # è·å–æ•°æ®ä¿ç•™ç­–ç•¥
PUT /audit/retention-policies        # æ›´æ–°ä¿ç•™ç­–ç•¥

# å†…éƒ¨å®¡è®¡æ¥å£
POST /internal/audit/log             # è®°å½•å®¡è®¡æ—¥å¿—
POST /internal/audit/security-event  # è®°å½•å®‰å…¨äº‹ä»¶
```

## äº”ã€æƒé™éªŒè¯é€»è¾‘è¯¦ç»†è®¾è®¡

### 5.1 é¡¹ç›®è®¿é—®æƒé™éªŒè¯æµç¨‹
```yaml
é¡¹ç›®è®¿é—®éªŒè¯é€»è¾‘:
  1. æ£€æŸ¥é¡¹ç›®å¯è§æ€§:
     - å¦‚æœæ˜¯publicé¡¹ç›® -> å…è®¸æ‰€æœ‰äººæŸ¥çœ‹åŸºæœ¬ä¿¡æ¯
     - å¦‚æœæ˜¯privateé¡¹ç›® -> ç»§ç»­æƒé™æ£€æŸ¥
     
  2. æ£€æŸ¥ç”¨æˆ·ç¾¤ç»„å…³ç³»:
     - å¦‚æœæ˜¯ç¾¤ä¸» -> å®Œå…¨è®¿é—®æƒé™
     - å¦‚æœæ˜¯ç¾¤ç»„ç®¡ç†å‘˜ -> å®Œå…¨è®¿é—®æƒé™
     - å¦‚æœæ˜¯é¡¹ç›®ç»´æŠ¤å‘˜ -> é¡¹ç›®çº§ç®¡ç†æƒé™
     - å¦‚æœæ˜¯ç¾¤ç»„æˆå‘˜ -> åŸºç¡€è®¿é—®æƒé™
     - å¦‚æœä¸åœ¨ç¾¤ç»„å†… -> æ‹’ç»è®¿é—®æˆ–å¼•å¯¼ç”³è¯·åŠ å…¥
     
  3. æ£€æŸ¥å…·ä½“æ“ä½œæƒé™:
     - æ ¹æ®ç”¨æˆ·è§’è‰²å’Œé¡¹ç›®è®¾ç½®ç¡®å®šå…·ä½“æƒé™
     - æ£€æŸ¥é¡¹ç›®çš„allow_member_editç­‰è®¾ç½®
     - éªŒè¯æ“ä½œç±»å‹ï¼ˆæŸ¥çœ‹ã€ç¼–è¾‘ã€ç®¡ç†ç­‰ï¼‰
```

### 5.2 ç¾¤ç»„åŠ å…¥ç”³è¯·æµç¨‹
```yaml
åŠ å…¥ç¾¤ç»„æµç¨‹:
  1. ç”¨æˆ·å‘èµ·ç”³è¯·:
     - æœç´¢å¹¶æ‰¾åˆ°ç›®æ ‡ç¾¤ç»„
     - å¡«å†™ç”³è¯·ç†ç”±
     - æäº¤åŠ å…¥ç”³è¯·
     
  2. ç”³è¯·å®¡æ ¸:
     - ç¾¤ä¸»æˆ–ç¾¤ç»„ç®¡ç†å‘˜æ”¶åˆ°é€šçŸ¥
     - æŸ¥çœ‹ç”³è¯·è€…ä¿¡æ¯å’Œç”³è¯·ç†ç”±
     - å†³å®šæ‰¹å‡†æˆ–æ‹’ç»ç”³è¯·
     
  3. ç”³è¯·ç»“æœ:
     - æ‰¹å‡† -> ç”¨æˆ·æˆä¸ºç¾¤ç»„æˆå‘˜ï¼Œè·å¾—ç›¸åº”æƒé™
     - æ‹’ç» -> é€šçŸ¥ç”³è¯·è€…ï¼Œå¯ä»¥å†æ¬¡ç”³è¯·
     - è¶…æ—¶ -> ç”³è¯·è‡ªåŠ¨è¿‡æœŸ
```

### 5.3 æƒé™ç»§æ‰¿æœºåˆ¶
```yaml
æƒé™ç»§æ‰¿è§„åˆ™:
  1. ç¾¤ç»„æƒé™ç»§æ‰¿:
     - ç¾¤ç»„æˆå‘˜è‡ªåŠ¨è·å¾—ç¾¤ç»„å†…æ‰€æœ‰é¡¹ç›®çš„æŸ¥çœ‹æƒé™
     - ç¾¤ç»„ç®¡ç†å‘˜è‡ªåŠ¨è·å¾—ç¾¤ç»„å†…æ‰€æœ‰é¡¹ç›®çš„ç®¡ç†æƒé™
     - ç¾¤ä¸»æ‹¥æœ‰ç¾¤ç»„å’Œé¡¹ç›®çš„å®Œå…¨æ§åˆ¶æƒé™
     
  2. é¡¹ç›®æƒé™ç»§æ‰¿:
     - é¡¹ç›®ç»´æŠ¤å‘˜æ‹¥æœ‰æŒ‡å®šé¡¹ç›®çš„å®Œå…¨ç®¡ç†æƒé™
     - é¡¹ç›®è®¾ç½®å¯ä»¥è¦†ç›–é»˜è®¤çš„ç¾¤ç»„æƒé™
     - å¤–éƒ¨ç”¨æˆ·æƒé™å—é¡¹ç›®å¯è§æ€§è®¾ç½®é™åˆ¶
     
  3. èµ„æºæƒé™ç»§æ‰¿:
     - è®¾è®¡æ–‡æ¡£ç»§æ‰¿é¡¹ç›®æƒé™
     - æ–‡ä»¶èµ„æºç»§æ‰¿é¡¹ç›®æƒé™
     - è¯„è®ºå’Œè®¨è®ºæƒé™ä¾èµ–äºèµ„æºæƒé™
```

## å…­ã€æœåŠ¡é—´é€šä¿¡è®¾è®¡

### 6.1 APIç½‘å…³è·¯ç”±é…ç½®
```yaml
routes:
  - path: "/auth/*"
    service: "auth-service"
    requires_auth: false
    
  - path: "/api/v1/permissions/*"
    service: "permission-service"
    requires_auth: true
    permissions: ["permission.read"]
    
  - path: "/api/v1/teams/*"
    service: "team-service"
    requires_auth: true
    
  - path: "/api/v1/projects/*"
    service: "project-service"
    requires_auth: true
    
  - path: "/api/v1/diagrams/*"
    service: "architecture-service"
    requires_auth: true
    permissions: ["diagram.read"]
    
  - path: "/api/v1/flow-diagrams/*"
    service: "flow-diagram-service"
    requires_auth: true
    
  - path: "/api/v1/api-specs/*"
    service: "api-design-service"
    requires_auth: true
    
  - path: "/api/v1/db-designs/*"
    service: "db-design-service"
    requires_auth: true
    
  - path: "/api/v1/feature-maps/*"
    service: "feature-map-service"
    requires_auth: true
    
  - path: "/api/v1/collaboration/*"
    service: "collaboration-service"
    requires_auth: true
    
  - path: "/api/v1/version-control/*"
    service: "version-control-service"
    requires_auth: true
    
  - path: "/api/v1/integrations/*"
    service: "integration-service"
    requires_auth: true
    
  - path: "/api/v1/search/*"
    service: "search-service"
    requires_auth: true
    
  - path: "/api/v1/files/*"
    service: "file-service"
    requires_auth: true
    
  - path: "/api/v1/notifications/*"
    service: "notification-service"
    requires_auth: true
    
  - path: "/api/v1/audit/*"
    service: "audit-service"
    requires_auth: true
    permissions: ["audit.read"]
```

### 6.2 å†…éƒ¨æœåŠ¡è°ƒç”¨
```yaml
# è®¤è¯æµç¨‹
1. Client -> API Gateway: Request with JWT
2. API Gateway -> Auth Service: POST /internal/validate-token
3. Auth Service -> API Gateway: User info and basic permissions
4. API Gateway -> Permission Service: POST /internal/permissions/check
5. Permission Service -> API Gateway: Detailed permission result
6. API Gateway -> Target Service: Forwarded request with user context
7. Target Service -> API Gateway: Response
8. API Gateway -> Client: Final response

# æƒé™æ£€æŸ¥æµç¨‹
1. Service -> Permission Service: POST /internal/permissions/check
2. Permission Service: Check user permissions for resource
3. Permission Service -> Service: Permission result

# å®¡è®¡è®°å½•æµç¨‹
1. Any Service -> Audit Service: POST /internal/audit/log
2. Audit Service: Store audit log
3. If high risk -> Notification Service: Send alert
```

### 6.3 äº‹ä»¶é©±åŠ¨æ¶æ„
```yaml
# RabbitMQäº¤æ¢æœºå’Œé˜Ÿåˆ—è®¾è®¡
exchanges:
  - name: platform.events
    type: topic
    
queues:
  - name: user.events
    routing_key: "user.*"
    consumers: [notification-service, audit-service, permission-service]
    
  - name: project.events
    routing_key: "project.*"
    consumers: [search-service, notification-service, permission-service]
    
  - name: team.events
    routing_key: "team.*"
    consumers: [notification-service, permission-service, audit-service]
    
  - name: collaboration.events
    routing_key: "collaboration.*"
    consumers: [notification-service, version-control-service]
    
  - name: file.events
    routing_key: "file.*"
    consumers: [search-service, audit-service]
    
  - name: security.events
    routing_key: "security.*"
    consumers: [audit-service, notification-service]
    
  - name: permission.events
    routing_key: "permission.*"
    consumers: [audit-service, notification-service]
```

## ä¸ƒã€ç¼“å­˜ç­–ç•¥è®¾è®¡

### Redisç¼“å­˜åˆ†å±‚
```yaml
# ç”¨æˆ·ç›¸å…³ç¼“å­˜
user_cache:
  user_profile: 
    pattern: "user:profile:{user_id}"
    ttl: 3600
  user_permissions:
    pattern: "user:permissions:{user_id}:{resource_type}:{resource_id}"
    ttl: 1800
  user_sessions:
    pattern: "user:sessions:{user_id}"
    ttl: 7200
  user_teams:
    pattern: "user:teams:{user_id}"
    ttl: 1800

# æƒé™ç›¸å…³ç¼“å­˜
permission_cache:
  team_permissions:
    pattern: "permissions:team:{team_id}:{user_id}"
    ttl: 1800
  project_permissions:
    pattern: "permissions:project:{project_id}:{user_id}"
    ttl: 1800
  resource_permissions:
    pattern: "permissions:resource:{resource_type}:{resource_id}:{user_id}"
    ttl: 900
  permission_policies:
    pattern: "permissions:policies:{policy_type}"
    ttl: 3600

# é¡¹ç›®ç›¸å…³ç¼“å­˜
project_cache:
  project_info:
    pattern: "project:info:{project_id}"
    ttl: 1800
  project_members:
    pattern: "project:members:{project_id}"
    ttl: 900
  team_projects:
    pattern: "team:projects:{team_id}"
    ttl: 1800

# åä½œç›¸å…³ç¼“å­˜
collaboration_cache:
  active_sessions:
    pattern: "collab:sessions:{document_id}"
    ttl: 300
  document_locks:
    pattern: "collab:locks:{document_id}"
    ttl: 600
  operation_queue:
    pattern: "collab:operations:{document_id}"
    ttl: 120

# APIå“åº”ç¼“å­˜
api_cache:
  search_results:
    pattern: "api:search:{query_hash}"
    ttl: 300
  static_data:
    pattern: "api:static:{endpoint}:{params_hash}"
    ttl: 3600
```

## å…«ã€å®‰å…¨æ¶æ„è®¾è®¡

### 8.1 è®¤è¯ä¸æˆæƒ
```yaml
authentication:
  jwt:
    algorithm: "RS256"
    access_token_ttl: 7200
    refresh_token_ttl: 2592000
    
  oauth_providers:
    - google
    - github
    - microsoft
    - azure_ad
    
  mfa:
    totp_enabled: true
    backup_codes: true
    sms_enabled: false

authorization:
  model: "RBAC + ABAC"
  levels:
    - platform_admin
    - team_owner
    - team_admin
    - project_maintainer
    - member
    - viewer
    
  permissions:
    teams: [read, write, admin, delete, invite, manage_members]
    projects: [read, write, admin, delete, create, manage_access]
    designs: [read, write, comment, share, version, collaborate]
    files: [read, write, upload, download, share, version]
```

### 8.2 æ•°æ®å®‰å…¨
```yaml
data_security:
  encryption:
    at_rest: "AES-256"
    in_transit: "TLS 1.3"
    key_rotation: "quarterly"
    
  data_classification:
    public: "Public information"
    internal: "Internal company data"
    confidential: "Confidential business data"
    restricted: "Highly sensitive data"
    
  privacy:
    gdpr_compliance: true
    data_retention: "configurable per data type"
    right_to_deletion: true
    data_export: true
    data_anonymization: true
```

### 8.3 å®‰å…¨ç›‘æ§
```yaml
security_monitoring:
  threat_detection:
    failed_login_threshold: 5
    suspicious_ip_detection: true
    privilege_escalation_detection: true
    unusual_access_pattern_detection: true
    
  incident_response:
    auto_account_lockout: true
    admin_notification: true
    security_log_retention: "7 years"
    automated_threat_response: true
    
  vulnerability_management:
    dependency_scanning: "automated"
    code_scanning: "on_commit"
    infrastructure_scanning: "weekly"
    penetration_testing: "quarterly"
```

## ä¹ã€æ€§èƒ½ä¼˜åŒ–æ¶æ„

### 9.1 æ•°æ®åº“ä¼˜åŒ–
```sql
-- åˆ†åŒºç­–ç•¥
CREATE TABLE audit_logs (
    -- fields...
) PARTITION BY RANGE (YEAR(timestamp)) (
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);

-- è¯»å†™åˆ†ç¦»
DATABASE_CONFIG:
  master: "mysql-master.internal:3306"
  replicas:
    - "mysql-replica-1.internal:3306"
    - "mysql-replica-2.internal:3306"
  read_write_split: true
  load_balance: "round_robin"
  
-- ç´¢å¼•ä¼˜åŒ–ç­–ç•¥
permission_related_indexes:
  - team_members: (team_id, user_id, role)
  - project_maintainers: (project_id, user_id)
  - user_permission_cache: (user_id, resource_type, resource_id)
  - audit_logs: (user_id, timestamp), (resource_type, resource_id)
```

### 9.2 åº”ç”¨å±‚ä¼˜åŒ–
```yaml
performance:
  connection_pooling:
    mysql_pool_size: 20
    redis_pool_size: 10
    mongodb_pool_size: 15
    
  async_processing:
    email_queue: true
    file_processing: true
    search_indexing: true
    permission_calculation: true
    
  caching:
    levels: ["application", "database", "cdn"]
    hit_ratio_target: 0.85
    permission_cache_strategy: "hierarchical"
```

### 9.3 å‰ç«¯ä¼˜åŒ–
```yaml
frontend_optimization:
  code_splitting: "route_based"
  lazy_loading: "components_and_images"
  cdn: "global_distribution"
  compression: "gzip_and_brotli"
  service_worker: "offline_support"
  permission_preloading: "user_context_based"
```

## åã€ç›‘æ§ä¸è¿ç»´

### 10.1 ç›‘æ§æŒ‡æ ‡
```yaml
metrics:
  application:
    - http_requests_total
    - http_request_duration_seconds
    - permission_check_duration_seconds
    - collaboration_active_users
    - document_edit_operations_total
    - cache_hit_rate
    - database_query_duration
    
  infrastructure:
    - cpu_usage_percent
    - memory_usage_percent
    - disk_usage_percent
    - network_io_bytes
    - database_connections
    
  business:
    - user_registration_rate
    - team_creation_rate
    - project_creation_rate
    - collaboration_session_duration
    - api_usage_by_endpoint
    - feature_adoption_rate
    - permission_check_success_rate
    
  security:
    - failed_login_attempts
    - permission_violations
    - suspicious_activities
    - security_events_by_severity
```

### 10.2 æ—¥å¿—ç®¡ç†
```yaml
logging:
  structured: true
  format: "json"
  correlation_id: true
  
  levels:
    development: "DEBUG"
    staging: "INFO"
    production: "WARN"
    
  retention:
    application_logs: "30 days"
    audit_logs: "7 years"
    access_logs: "90 days"
    error_logs: "1 year"
    security_logs: "7 years"
```

### 10.3 å‘Šè­¦ç­–ç•¥
```yaml
alerts:
  critical:
    - service_down: "immediate"
    - high_error_rate: "5 minutes"
    - database_connection_failure: "immediate"
    - security_breach: "immediate"
    - permission_system_failure: "immediate"
  
  warning:
    - high_response_time: "15 minutes"
    - memory_usage_high: "30 minutes"
    - cache_miss_rate_high: "1 hour"
    - disk_space_low: "1 hour"
    - permission_check_latency_high: "15 minutes"
```

## åä¸€ã€éƒ¨ç½²æ¶æ„

### 11.1 å®¹å™¨åŒ–éƒ¨ç½²
```yaml
# Docker Composeç¤ºä¾‹
version: '3.8'
services:
  api-gateway:
    image: platform/api-gateway:latest
    ports:
      - "8080:8080"
    environment:
      - REDIS_URL=redis://redis:6379
      - AUTH_SERVICE_URL=http://auth-service:8001
      - PERMISSION_SERVICE_URL=http://permission-service:8002
    depends_on:
      - redis
      - auth-service
      - permission-service
    
  auth-service:
    image: platform/auth-service:latest
    environment:
      - DATABASE_URL=mysql://mysql:3306/auth_db
      - REDIS_URL=redis://redis:6379
    depends_on:
      - mysql
      - redis
      
  permission-service:
    image: platform/permission-service:latest
    environment:
      - DATABASE_URL=mysql://mysql:3306/permission_db
      - REDIS_URL=redis://redis:6379
    depends_on:
      - mysql
      - redis
```

### 11.2 é«˜å¯ç”¨æ¶æ„
```yaml
high_availability:
  load_balancer:
    type: "nginx"
    health_checks: true
    failover: "automatic"
    
  database:
    mysql:
      master_slave: true
      read_replicas: 2
      failover: "automatic"
    mongodb:
      replica_set: true
      nodes: 3
    redis:
      cluster_mode: true
      nodes: 6
      
  storage:
    minio:
      distributed: true
      nodes: 4
      replication: "2x"
      
  backup:
    frequency: "daily"
    retention: "30 days"
    cross_region: true
```

## åäºŒã€å®æ–½è·¯çº¿å›¾

### Phase 1: æ ¸å¿ƒåŸºç¡€ (3-4ä¸ªæœˆ)
**ä¼˜å…ˆçº§: P0**
```yaml
deliverables:
  infrastructure:
    - APIç½‘å…³æœåŠ¡ (åŸºç¡€åŠŸèƒ½ + æƒé™é¢„æ£€)
    - è®¤è¯æˆæƒæœåŠ¡ (å®Œæ•´åŠŸèƒ½)
    - æƒé™ç®¡ç†æœåŠ¡ (æ ¸å¿ƒæƒé™éªŒè¯)
    - åŸºç¡€ç›‘æ§å’Œæ—¥å¿—
    
  business_logic:
    - ç¾¤ç»„æœåŠ¡ (å®Œæ•´æƒé™ä½“ç³»)
    - é¡¹ç›®æœåŠ¡ (åŸºç¡€åŠŸèƒ½ + æƒé™æ§åˆ¶)
    - æ¶æ„è®¾è®¡æœåŠ¡ (åŸºç¡€å›¾å½¢ç¼–è¾‘ + æƒé™éªŒè¯)
    - æ–‡ä»¶æœåŠ¡ (åŸºç¡€ä¸Šä¼ ä¸‹è½½ + æƒé™æ§åˆ¶)
    
  milestones:
    - ç”¨æˆ·å¯ä»¥æ³¨å†Œç™»å½•
    - å®Œæ•´çš„ç¾¤ç»„æƒé™ä½“ç³»è¿è¡Œ
    - å¯ä»¥åˆ›å»ºå›¢é˜Ÿå’Œé¡¹ç›®å¹¶ç®¡ç†æƒé™
    - å¯ä»¥åˆ›å»ºå’Œç¼–è¾‘ç®€å•çš„æ¶æ„å›¾
    - ç³»ç»Ÿå…·å¤‡åŸºæœ¬çš„ç›‘æ§èƒ½åŠ›
    
  success_criteria:
    - ç³»ç»Ÿå¯ç”¨æ€§ > 99%
    - æƒé™éªŒè¯å“åº”æ—¶é—´ < 100ms
    - å“åº”æ—¶é—´ < 2ç§’
    - æ”¯æŒ100å¹¶å‘ç”¨æˆ·
    - æƒé™éªŒè¯å‡†ç¡®ç‡ 100%
```

### Phase 2: åä½œå¢å¼º (3-4ä¸ªæœˆ)
**ä¼˜å…ˆçº§: P1**
```yaml
deliverables:
  collaboration:
    - å®æ—¶åä½œæœåŠ¡ (WebSocketæ”¯æŒ + æƒé™æ§åˆ¶)
    - ç‰ˆæœ¬æ§åˆ¶æœåŠ¡ (åŸºç¡€ç‰ˆæœ¬ç®¡ç†)
    - è¯„è®ºå’Œè®¨è®ºåŠŸèƒ½
    
  design_tools:
    - APIè®¾è®¡æœåŠ¡ (OpenAPIæ”¯æŒ)
    - æ•°æ®åº“è®¾è®¡æœåŠ¡ (åŸºç¡€ERå›¾)
    - æ”¹è¿›çš„æ¶æ„å›¾åŠŸèƒ½
    
  enhancements:
    - é«˜çº§æƒé™ç®¡ç†å’Œç»§æ‰¿
    - æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶
    - åŸºç¡€æœç´¢åŠŸèƒ½
    - å®Œæ•´çš„å®¡è®¡ä½“ç³»
    
  milestones:
    - å¤šäººå¯ä»¥åŒæ—¶ç¼–è¾‘åŒä¸€ä¸ªå›¾
    - æ”¯æŒAPIè®¾è®¡å’Œæ•°æ®åº“è®¾è®¡
    - å…·å¤‡å®Œæ•´çš„æƒé™æ§åˆ¶å’Œå®¡è®¡
    - æƒé™ç”³è¯·å’Œå®¡æ‰¹æµç¨‹å®Œå–„
    
  success_criteria:
    - æ”¯æŒ10äººåŒæ—¶åä½œç¼–è¾‘
    - ç‰ˆæœ¬å†²çªè§£å†³æˆåŠŸç‡ > 95%
    - æƒé™æ“ä½œå®¡è®¡è¦†ç›–ç‡ 100%
    - ç”¨æˆ·æ»¡æ„åº¦ > 4.0/5.0
```

### Phase 3: é«˜çº§åŠŸèƒ½ (2-3ä¸ªæœˆ)
**ä¼˜å…ˆçº§: P2**
```yaml
deliverables:
  advanced_tools:
    - æµç¨‹å›¾è®¾è®¡æœåŠ¡
    - åŠŸèƒ½å¯¼å›¾æœåŠ¡
    - é«˜çº§æœç´¢å’Œåˆ†æ
    
  integrations:
    - é›†æˆæœåŠ¡ (Webhookæ”¯æŒ)
    - é€šçŸ¥æœåŠ¡ (é‚®ä»¶å’Œåº”ç”¨å†…é€šçŸ¥)
    - åŸºç¡€å¤–éƒ¨é›†æˆ (GitHub, Jira)
    
  enterprise_features:
    - å®Œæ•´çš„å®¡è®¡æœåŠ¡
    - æ•°æ®å¯¼å‡ºå’Œå¤‡ä»½
    - é«˜çº§ç”¨æˆ·ç®¡ç†
    - åˆè§„æŠ¥å‘Šç”Ÿæˆ
    
  milestones:
    - æ”¯æŒå®Œæ•´çš„è®¾è®¡å·¥å…·å¥—ä»¶
    - å…·å¤‡ä¼ä¸šçº§çš„é›†æˆèƒ½åŠ›
    - æ»¡è¶³å®Œæ•´çš„åˆè§„è¦æ±‚
    - æƒé™ä½“ç³»æ”¯æŒå¤æ‚åœºæ™¯
    
  success_criteria:
    - æ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨ç‡ > 80%
    - é›†æˆæˆåŠŸç‡ > 95%
    - ç³»ç»Ÿæ€§èƒ½ < 500mså“åº”æ—¶é—´
    - æƒé™éªŒè¯æ€§èƒ½ < 50ms
```

### Phase 4: ä¼˜åŒ–å®Œå–„ (2-3ä¸ªæœˆ)
**ä¼˜å…ˆçº§: P3**
```yaml
deliverables:
  performance:
    - ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–
    - ç¼“å­˜ç­–ç•¥å®Œå–„
    - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
    - æƒé™è®¡ç®—ä¼˜åŒ–
    
  enterprise:
    - å®Œæ•´çš„å®¡è®¡å’Œåˆè§„åŠŸèƒ½
    - é«˜çº§å®‰å…¨ç‰¹æ€§
    - æ’ä»¶å¸‚åœºå’Œæ‰©å±•
    
  user_experience:
    - ç§»åŠ¨ç«¯æ”¯æŒ
    - é«˜çº§åˆ†æå’ŒæŠ¥å‘Š
    - ç”¨æˆ·ä½“éªŒä¼˜åŒ–
    - æƒé™ç®¡ç†ç•Œé¢ä¼˜åŒ–
    
  milestones:
    - ç³»ç»Ÿè¾¾åˆ°ç”Ÿäº§å°±ç»ªçŠ¶æ€
    - å…·å¤‡å®Œæ•´çš„ä¼ä¸šçº§ç‰¹æ€§
    - æ”¯æŒå¤§è§„æ¨¡ç”¨æˆ·ä½¿ç”¨
    - æƒé™ä½“ç³»æ”¯æŒå¤æ‚ä¼ä¸šåœºæ™¯
    
  success_criteria:
    - æ”¯æŒ10,000+å¹¶å‘ç”¨æˆ·
    - ç³»ç»Ÿå¯ç”¨æ€§ > 99.9%
    - æƒé™éªŒè¯å»¶è¿Ÿ < 20ms
    - ç”¨æˆ·æ»¡æ„åº¦ > 4.5/5.0
```

## åä¸‰ã€æŠ€æœ¯é£é™©ä¸åº”å¯¹ç­–ç•¥

### 13.1 é«˜é£é™©é¡¹ç›®
```yaml
complex_permission_system:
  risk_level: "é«˜"
  challenges:
    - æƒé™ç»§æ‰¿é€»è¾‘å¤æ‚
    - æ€§èƒ½ä¼˜åŒ–å›°éš¾
    - æƒé™å†²çªè§£å†³
    - ç¼“å­˜ä¸€è‡´æ€§ä¿è¯
  mitigation:
    - åˆ†é˜¶æ®µå®ç°æƒé™åŠŸèƒ½
    - å»ºç«‹å®Œå–„çš„æµ‹è¯•ç”¨ä¾‹
    - å¼•å…¥æƒé™å†³ç­–å¼•æ“
    - å®æ–½æƒé™å®¡è®¡æœºåˆ¶
    
real_time_collaboration:
  risk_level: "é«˜"
  challenges:
    - æ“ä½œå˜æ¢ç®—æ³•å¤æ‚
    - å†²çªè§£å†³æœºåˆ¶
    - WebSocketè¿æ¥ç®¡ç†
    - æƒé™å®æ—¶éªŒè¯
  mitigation:
    - é‡‡ç”¨æˆç†Ÿçš„OTç®—æ³•åº“
    - åˆ†é˜¶æ®µå®ç°åŠŸèƒ½
    - å……åˆ†çš„æµ‹è¯•å’ŒéªŒè¯
    - æƒé™ç¼“å­˜ä¼˜åŒ–
    
large_file_handling:
  risk_level: "ä¸­"
  challenges:
    - ä¸Šä¼ æ€§èƒ½é—®é¢˜
    - å­˜å‚¨æˆæœ¬æ§åˆ¶
    - é¢„è§ˆç”Ÿæˆæ•ˆç‡
    - æƒé™æ§åˆ¶ç²’åº¦
  mitigation:
    - åˆ†å—ä¸Šä¼ æŠ€æœ¯
    - CDNåŠ é€Ÿåˆ†å‘
    - å¼‚æ­¥å¤„ç†é˜Ÿåˆ—
    - æ–‡ä»¶çº§æƒé™æ§åˆ¶
    
microservice_complexity:
  risk_level: "ä¸­"
  challenges:
    - æœåŠ¡é—´é€šä¿¡å¤æ‚
    - æ•°æ®ä¸€è‡´æ€§ä¿è¯
    - åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†
    - æƒé™æœåŠ¡ä¾èµ–
  mitigation:
    - æ ‡å‡†åŒ–APIè®¾è®¡
    - äº‹ä»¶é©±åŠ¨æ¶æ„
    - åˆç†çš„äº‹åŠ¡è¾¹ç•Œ
    - æƒé™æœåŠ¡é«˜å¯ç”¨è®¾è®¡
```

### 13.2 ä¸šåŠ¡é£é™©
```yaml
user_adoption:
  risk_level: "ä¸­"
  challenges:
    - ç”¨æˆ·å­¦ä¹ æˆæœ¬é«˜
    - æƒé™ç®¡ç†å¤æ‚æ€§
    - ç«äº‰äº§å“å­˜åœ¨
    - åŠŸèƒ½å¤æ‚åº¦é«˜
  mitigation:
    - ç”¨æˆ·ä½“éªŒä¼˜å…ˆ
    - æ¸è¿›å¼æƒé™å¼•å¯¼
    - å®Œå–„çš„å¸®åŠ©æ–‡æ¡£
    - æƒé™æ¨¡æ¿å’Œé¢„è®¾
    
data_security:
  risk_level: "é«˜"
  challenges:
    - ä¼ä¸šæ•°æ®å®‰å…¨è¦æ±‚
    - æƒé™ç³»ç»Ÿå®‰å…¨æ€§
    - åˆè§„æ€§è¦æ±‚
    - éšç§ä¿æŠ¤
  mitigation:
    - ä¸¥æ ¼çš„å®‰å…¨æ ‡å‡†
    - å®šæœŸå®‰å…¨å®¡è®¡
    - åˆè§„è®¤è¯
    - æƒé™æœ€å°åŒ–åŸåˆ™
    
permission_performance:
  risk_level: "ä¸­"
  challenges:
    - æƒé™æ£€æŸ¥å»¶è¿Ÿ
    - ç¼“å­˜å¤æ‚æ€§
    - æ‰©å±•æ€§é™åˆ¶
    - ä¸€è‡´æ€§ä¿è¯
  mitigation:
    - å¤šå±‚ç¼“å­˜ç­–ç•¥
    - æƒé™é¢„è®¡ç®—
    - å¼‚æ­¥æƒé™æ›´æ–°
    - æ€§èƒ½ç›‘æ§ä¼˜åŒ–
```

## åå››ã€æˆåŠŸæŒ‡æ ‡ä¸è¯„ä¼°

### 14.1 æŠ€æœ¯æŒ‡æ ‡
```yaml
performance:
  availability: ">= 99.9%"
  response_time: "< 200ms (P95)"
  permission_check_time: "< 50ms (P95)"
  throughput: "> 10,000 RPS"
  error_rate: "< 0.1%"
  
scalability:
  concurrent_users: "> 10,000"
  data_volume: "> 100TB"
  transactions_per_second: "> 5,000"
  permission_checks_per_second: "> 50,000"
  
reliability:
  mtbf: "> 720 hours"
  mttr: "< 30 minutes"
  backup_success_rate: "100%"
  permission_accuracy: "100%"
```

### 14.2 ä¸šåŠ¡æŒ‡æ ‡
```yaml
user_metrics:
  monthly_active_users: "growth > 20%"
  user_retention_rate: "> 85%"
  feature_adoption_rate: "> 80%"
  user_satisfaction: "> 4.5/5.0"
  permission_ease_of_use: "> 4.0/5.0"
  
productivity:
  design_efficiency_improvement: "> 40%"
  collaboration_effectiveness: "> 50%"
  time_to_market_reduction: "> 30%"
  permission_management_efficiency: "> 60%"
  
financial:
  customer_acquisition_cost: "< $100"
  customer_lifetime_value: "> $1000"
  revenue_growth: "> 100% YoY"
  enterprise_adoption_rate: "> 40%"
```

### 14.3 å®‰å…¨æŒ‡æ ‡
```yaml
security_metrics:
  permission_violations: "0 per month"
  unauthorized_access_attempts: "< 0.1% of total requests"
  data_breach_incidents: "0 per year"
  compliance_audit_score: "> 95%"
  
audit_metrics:
  audit_log_completeness: "100%"
  audit_trail_integrity: "100%"
  compliance_report_accuracy: "> 99%"
  security_incident_response_time: "< 15 minutes"
```

### 14.4 è¿è¥æŒ‡æ ‡
```yaml
operational:
  deployment_frequency: "> 1 per week"
  deployment_success_rate: "> 99%"
  incident_response_time: "< 15 minutes"
  security_incident_count: "0 per quarter"
  permission_system_uptime: "> 99.95%"
  
cost:
  infrastructure_cost_per_user: "< $5/month"
  cost_growth_vs_user_growth: "< 1:1 ratio"
  operational_efficiency: "improve 20% YoY"
  permission_service_cost_ratio: "< 5% of total"
```

## åäº”ã€æ•°æ®æ²»ç†ä¸åˆè§„

### 15.1 æ•°æ®åˆ†ç±»ä¸ä¿æŠ¤
```yaml
data_classification:
  public_data:
    - å…¬å¼€é¡¹ç›®ä¿¡æ¯
    - äº§å“æ–‡æ¡£
    - å¸®åŠ©æ–‡æ¡£
    
  internal_data:
    - ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
    - é¡¹ç›®ç»Ÿè®¡æ•°æ®
    - ä½¿ç”¨åˆ†ææ•°æ®
    
  confidential_data:
    - ç§å¯†é¡¹ç›®å†…å®¹
    - å•†ä¸šæ•æ„Ÿè®¾è®¡
    - å®¢æˆ·ä¸šåŠ¡æ•°æ®
    
  restricted_data:
    - ç”¨æˆ·è®¤è¯ä¿¡æ¯
    - æ•æ„Ÿä¸ªäººæ•°æ®
    - è´¢åŠ¡ä¿¡æ¯

data_protection_measures:
  encryption:
    - ä¼ è¾“åŠ å¯†: TLS 1.3
    - å­˜å‚¨åŠ å¯†: AES-256
    - å¯†é’¥ç®¡ç†: HSM
    
  access_control:
    - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
    - æœ€å°æƒé™åŸåˆ™
    - å®šæœŸæƒé™å®¡æŸ¥
    
  monitoring:
    - æ•°æ®è®¿é—®æ—¥å¿—
    - å¼‚å¸¸è¡Œä¸ºæ£€æµ‹
    - å®æ—¶å®‰å…¨ç›‘æ§
```

### 15.2 åˆè§„æ¡†æ¶
```yaml
compliance_standards:
  gdpr:
    - æ•°æ®ä¸»ä½“æƒåˆ©
    - æ•°æ®å¤„ç†åˆæ³•æ€§
    - æ•°æ®ä¿æŠ¤å½±å“è¯„ä¼°
    - è¿è§„é€šçŸ¥æœºåˆ¶
    
  iso27001:
    - ä¿¡æ¯å®‰å…¨ç®¡ç†ä½“ç³»
    - é£é™©è¯„ä¼°å’Œç®¡ç†
    - å®‰å…¨æ§åˆ¶æªæ–½
    - æŒç»­æ”¹è¿›
    
  soc2:
    - å®‰å…¨æ€§
    - å¯ç”¨æ€§
    - å¤„ç†å®Œæ•´æ€§
    - ä¿å¯†æ€§
    - éšç§ä¿æŠ¤

compliance_processes:
  regular_audits:
    - å­£åº¦å†…éƒ¨å®¡è®¡
    - å¹´åº¦å¤–éƒ¨å®¡è®¡
    - æŒç»­åˆè§„ç›‘æ§
    
  documentation:
    - æ”¿ç­–å’Œç¨‹åºæ–‡æ¡£
    - æ“ä½œæ‰‹å†Œ
    - åŸ¹è®­ææ–™
    - äº‹ä»¶å“åº”è®¡åˆ’
```

## åå…­ã€æ€»ç»“

è¿™ä»½é›†æˆäº†å®Œå–„æƒé™ä½“ç³»çš„è½¯ä»¶æœåŠ¡ç®¡ç†å¹³å°è®¾è®¡æ–¹æ¡ˆæä¾›äº†æ„å»ºç°ä»£åŒ–ã€ä¼ä¸šçº§åä½œå¹³å°çš„è¯¦ç»†è“å›¾ã€‚å…³é”®ç‰¹ç‚¹åŒ…æ‹¬ï¼š

### æ¶æ„ä¼˜åŠ¿
1. **å®Œå–„çš„æƒé™ä½“ç³»**: åŸºäºç¾¤ç»„çš„åˆ†å±‚æƒé™ç®¡ç†ï¼Œæ”¯æŒå¤æ‚çš„ä¼ä¸šåœºæ™¯
2. **æ¸…æ™°çš„æœåŠ¡è¾¹ç•Œ**: æ¯ä¸ªå¾®æœåŠ¡èŒè´£æ˜ç¡®ï¼Œæƒé™æœåŠ¡ç‹¬ç«‹éƒ¨ç½²
3. **æ ‡å‡†åŒ–çš„é€šä¿¡**: ç»Ÿä¸€çš„APIè®¾è®¡å’Œæƒé™éªŒè¯æµç¨‹
4. **å¼ºå¤§çš„åŸºç¡€è®¾æ–½**: å®Œå–„çš„ç½‘å…³ã€è®¤è¯ã€æƒé™ã€ç›‘æ§ä½“ç³»
5. **ä¼ä¸šçº§ç‰¹æ€§**: å®‰å…¨ã€å®¡è®¡ã€åˆè§„ã€æ€§èƒ½ä¼˜åŒ–

### æƒé™åˆ›æ–°
1. **ç¾¤ç»„ä¸ºä¸­å¿ƒ**: ä»¥ç¾¤ç»„ä¸ºæ ¸å¿ƒçš„æƒé™ç®¡ç†æ¨¡å¼
2. **åˆ†å±‚ç»§æ‰¿**: çµæ´»çš„æƒé™ç»§æ‰¿å’Œè¦†ç›–æœºåˆ¶
3. **å®æ—¶éªŒè¯**: é«˜æ€§èƒ½çš„æƒé™éªŒè¯æœåŠ¡
4. **ç”³è¯·å®¡æ‰¹**: å®Œæ•´çš„æƒé™ç”³è¯·å’Œå®¡æ‰¹æµç¨‹
5. **å®¡è®¡è¿½è¸ª**: å…¨é¢çš„æƒé™æ“ä½œå®¡è®¡

### æŠ€æœ¯åˆ›æ–°
1. **å®æ—¶åä½œ**: æ”¯æŒå¤šäººåŒæ—¶ç¼–è¾‘çš„åä½œç³»ç»Ÿ
2. **æ™ºèƒ½æœç´¢**: åŸºäºElasticsearchçš„å…¨æ–‡æœç´¢å’Œæ™ºèƒ½æ¨è
3. **ç‰ˆæœ¬æ§åˆ¶**: Git-likeçš„ç‰ˆæœ¬ç®¡ç†å’Œåˆ†æ”¯åˆå¹¶
4. **å¤šæ ·åŒ–è®¾è®¡å·¥å…·**: æ¶æ„å›¾ã€æµç¨‹å›¾ã€APIè®¾è®¡ã€æ•°æ®åº“è®¾è®¡ã€åŠŸèƒ½å¯¼å›¾
5. **æƒé™ç¼“å­˜**: å¤šå±‚ç¼“å­˜ç­–ç•¥ä¼˜åŒ–æƒé™éªŒè¯æ€§èƒ½

### å®æ–½ä¿éšœ
1. **æ¸è¿›å¼äº¤ä»˜**: å››ä¸ªé˜¶æ®µçš„å®æ–½è·¯çº¿å›¾ï¼Œæƒé™ä½“ç³»ä¼˜å…ˆ
2. **é£é™©æ§åˆ¶**: è¯¦ç»†çš„é£é™©è¯†åˆ«å’Œåº”å¯¹ç­–ç•¥
3. **è´¨é‡ä¿è¯**: æ˜ç¡®çš„æˆåŠŸæŒ‡æ ‡å’Œè¯„ä¼°ä½“ç³»
4. **å¯æ‰©å±•æ€§**: æ”¯æŒå¤§è§„æ¨¡ç”¨æˆ·å’Œæ•°æ®é‡
5. **åˆè§„æ”¯æŒ**: æ»¡è¶³ä¼ä¸šçº§åˆè§„è¦æ±‚

è¯¥å¹³å°å°†æ˜¾è‘—æå‡è½¯ä»¶å¼€å‘å›¢é˜Ÿçš„è®¾è®¡æ•ˆç‡å’Œåä½œè´¨é‡ï¼Œé€šè¿‡å®Œå–„çš„æƒé™ç®¡ç†ä½“ç³»ç¡®ä¿ä¼ä¸šæ•°æ®å®‰å…¨ï¼Œä¸ºä¼ä¸šæ•°å­—åŒ–è½¬å‹æä¾›å¼ºæœ‰åŠ›çš„å·¥å…·æ”¯æ’‘ã€‚ç‰¹åˆ«æ˜¯æƒé™ä½“ç³»çš„è®¾è®¡ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°å¹³è¡¡å®‰å…¨æ€§ã€æ˜“ç”¨æ€§å’Œçµæ´»æ€§ï¼Œé€‚åº”å„ç§å¤æ‚çš„ä¼ä¸šç»„ç»‡ç»“æ„å’Œåä½œéœ€æ±‚ã€‚